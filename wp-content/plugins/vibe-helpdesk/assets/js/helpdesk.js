!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(0);function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=wp.element,i=(o.createElement,o.useState),l=o.useEffect,c=(o.Fragment,o.render,o.useRef),s=wp.data,p=(s.dispatch,s.select),u=function(e){var t=a(i(""),2),n=t[0],r=t[1];return l(function(){var t="",n="";switch(e.type){case"friends":n="user",t=e.id.item_id;break;case"group":n="group",t=e.id.item_id;break;case"activity":n="user",t=e.id.secondary_item_id;break;case"member":case"name":case"user_tip":case"user":n="user",t=e.id.user_id;break;default:n=e.type,t=e.id.item_id}localforage.getItem(n+"_"+t).then(function(a){null!==a?r(JSON.parse(a)):fetch("".concat(window.vibebp.api.url,"/avatar"),{method:"post",body:JSON.stringify({type:e.type,ids:e.id,token:p("vibebp").getToken()})}).then(function(e){return e.json()}).then(function(e){e.name&&(localforage.setItem(n+"_"+t,JSON.stringify(e)),r(e))})})},[]),"member"==e.type?wp.element.createElement("span",{className:"vibebp_member",title:n.name},wp.element.createElement("img",{src:n.avatar,className:"vibebp_avatar",onClick:e.click,alt:n.name,title:n.name}),wp.element.createElement("div",{dangerouslySetInnerHTML:{__html:n.name}})):"user_tip"==e.type?wp.element.createElement("span",{className:"vibebp_member tip",title:n.name},wp.element.createElement("img",{src:n.avatar,className:"vibebp_avatar",onClick:e.click,alt:n.name,title:n.name})):"name"==e.type?wp.element.createElement("span",null,n.name):wp.element.createElement("img",{src:n.avatar,className:"vibebp_avatar",onClick:e.click,alt:n.name,title:n.name})},m=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=c(Date.now());l(function(){var n=setTimeout(function(){Date.now()-a.current>=t&&(e(),a.current=Date.now())},t-(Date.now()-a.current));return function(){clearTimeout(n)}},[t].concat(r(n)))},d=(wp.element.createElement,function e(t){return wp.element.createElement("div",{className:"vibebp_sub_forum"},wp.element.createElement("div",{className:"vibebp_sub_forum_details"},wp.element.createElement("strong",null,t.forum.post_title),wp.element.createElement("div",{dangerouselySetInnerHTML:{__html:t.forum.post_content}})),wp.element.createElement("div",{className:"vibebp_topic_count"},wp.element.createElement("span",{className:"vicon vicon-comments"}),t.forum.topic_count),t.forum.hasOwnProperty("forums")&&t.forums.forums.length?t.forums.forums.map(function(t){return wp.element.createElement(e,{forum:t})}):"")});function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var b=wp.element,h=(b.createElement,b.useState),g=b.Fragment,y=wp.data,_=y.dispatch,E=y.select,O=function(e){var t=E("vibebp").getUser(),n=window.helpdesk.settings.agents_cap&&t.roles.includes(window.helpdesk.settings.agents_cap),r=v(h(""),2),a=r[0],o=r[1],i=v(h([]),2),l=i[0],c=i[1],s=v(h(null),2),p=s[0],u=s[1],d=v(h(!1),2),b=d[0],y=d[1];return m(function(){p&&p.abort();var e=new AbortController,t=p?{signal:e.signal}:{};u(e),c([]),a&&a.length>2&&(y(!0),fetch("".concat(window.helpdesk.api.url,"/bbp/users/canned-responses?nocache"),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(n,!0).forEach(function(t){w(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({method:"post"},t,{body:JSON.stringify({s:a,token:E("vibebp").getToken()})})).then(function(e){return e.json()}).then(function(e){y(!1),e.status&&e.data&&Array.isArray(e.data)&&c(e.data),e.hasOwnProperty("message")&&_("vibebp").addNotification({text:e.message})}).catch(function(e){y(!0)}))},500,[a]),wp.element.createElement(g,null,n?wp.element.createElement("div",{className:"canned_search_wrapper"},wp.element.createElement("div",{className:"canned_search_wrapper_header"},wp.element.createElement("div",{className:"vibebp_form_field"},wp.element.createElement("input",{type:"text",placeholder:window.helpdesk.translations.search_canned,onChange:function(e){o(e.target.value)},value:a}),wp.element.createElement("span",{class:"vicon vicon-search"})),b?wp.element.createElement("div",{className:"lds-ellipsis"},wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null)):""),l&&Array.isArray(l)?wp.element.createElement("div",{className:"canned_responses"},l.map(function(t){return wp.element.createElement("span",{className:"canned_response",onClick:function(){var n=t.post_content,r=t.raw;e.update({post_content:n,raw:r})}},t.post_title)})):""):"")};function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(n,!0).forEach(function(t){j(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var S=wp.element,C=(S.createElement,S.useState),A=S.useEffect,I=wp.data,x=I.dispatch,T=I.select,D=function(e){var t=P(C(e.reply),2),n=t[0],r=t[1],a=P(C({}),2),o=a[0],i=a[1],l=P(C(!1),2),c=l[0],s=l[1],p="vibe_reply_editor_".concat(n.id),u=P(C(0),2),m=u[0],d=(u[1],function(e){i({post_content:e.detail.raw_html,raw:e.detail.editor_content})});A(function(){var e=new CustomEvent("load_vibe_editor",{detail:{selector:".".concat(p).concat(m),content:n.hasOwnProperty("post_content")&&n.post_content?n.post_content:"",raw:n.hasOwnProperty("raw")&&n.raw?n.raw:"",components:"editor",updater:"".concat(p).concat(m)}});document.dispatchEvent(e),document.addEventListener("vibe_editor_content_update_".concat(p).concat(m),d)},[]);return wp.element.createElement("div",{className:"vibebp_reply_form"},wp.element.createElement(O,{update:function(e){var t,a,l;r(N({},n,{},e,{id:0})),i(N({},o,{},e)),t=N({},n,{},e,{id:0}),a=m,l=new CustomEvent("load_vibe_editor",{detail:{selector:".".concat(p).concat(a),content:t.hasOwnProperty("post_content")&&t.post_content?t.post_content:"",raw:t.hasOwnProperty("raw")&&t.raw?t.raw:"",components:"editor",updater:"".concat(p).concat(a),reinit:Math.random()}}),document.dispatchEvent(l),document.addEventListener("vibe_editor_content_update_".concat(p).concat(a),d)}}),wp.element.createElement("div",{className:"vibe_reply_editor"},wp.element.createElement("div",{className:"".concat(p).concat(m),"data-id":m},wp.element.createElement("textarea",{onChange:function(e){r(N({},n,{post_content:e.target.value})),i(N({},o,{post_content:e.target.value}))},value:n.post_content})),wp.element.createElement("div",{className:"vibebp_reply_form_actions"},wp.element.createElement("div",{className:"vibebp_reply_form_buttons"},window.helpdesk.settings.private_plugin_active?wp.element.createElement("div",{className:"vibebp_form_field helpdesk_private_reply"},wp.element.createElement("span",null,window.helpdesk.translations.make_reply_private),wp.element.createElement("div",{className:"switch"},n.hasOwnProperty("is_private")&&n.is_private?wp.element.createElement("input",{type:"checkbox",id:"".concat(p,"_private"),checked:!0,onClick:function(){r(N({},n,{is_private:!1}))}}):wp.element.createElement("input",{type:"checkbox",id:"".concat(p,"_private"),onClick:function(){r(N({},n,{is_private:!0}))}}),wp.element.createElement("label",{for:"".concat(p,"_private"),className:"slider"}))):"",o.post_content?wp.element.createElement("a",{className:c?"button is-primary is-loading":"button is-primary",onClick:function(){s(!0),fetch("".concat(window.helpdesk.api.url,"/bbp/replies/create?post"),{method:"post",body:JSON.stringify(N({},n,{post_content:o.post_content,raw:o.raw,token:T("vibebp").getToken()}))}).then(function(e){return e.json()}).then(function(t){s(!1),t.status&&(r(N({},n,{post_content:"",meta:[]})),e.update&&e.update(t.reply)),t.hasOwnProperty("message")&&x("vibebp").addNotification({text:t.message})})}},window.helpdesk.translations.submit):""))))};function J(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var L=wp.element,U=(L.createElement,L.useState),R=L.Fragment,M=L.useEffect,H=wp.data,F=H.dispatch,q=H.select,B=function(e){var t=J(U({}),2),n=t[0],r=t[1],a=q("vibebp").getUser(),o=J(U(!1),2),i=o[0],l=o[1],c=J(U(!1),2),s=c[0],p=c[1];M(function(){r(e.reply)},[e.reply]);return n.hasOwnProperty("id")?wp.element.createElement("div",{className:"vibebp_reply"},wp.element.createElement(u,{type:"member",id:{user_id:parseInt(n.author)}}),wp.element.createElement("div",{className:n.hasOwnProperty("is_private")&&n.is_private?"is_private vibebp_reply_content":"vibebp_reply_content"},wp.element.createElement("div",{className:"vibebp_reply_content_meta"},wp.element.createElement("div",null,wp.element.createElement("a",{href:n.permalink,className:"vicon vicon-link"}),wp.element.createElement("span",null,n.last_update)),wp.element.createElement("div",{className:"reply_action"},parseInt(a.id)===parseInt(n.author)?wp.element.createElement(R,null,wp.element.createElement("span",{className:"vicon vicon-pencil",onClick:function(){l(!i)}}),wp.element.createElement("span",{className:s?"vicon vicon-reload":"vicon vicon-trash",onClick:function(){if(n.id){p(!0);var t="?post&args=".concat(encodeURIComponent(JSON.stringify({id:n.id})));fetch("".concat(window.helpdesk.api.url,"/bbp/replies/delete").concat(t),{method:"post",body:JSON.stringify({reply_id:n.id,token:q("vibebp").getToken()})}).then(function(e){return e.json()}).then(function(t){t.status&&(p(!1),e.delete&&e.delete()),t.hasOwnProperty("message")&&F("vibebp").addNotification({text:t.message})}).catch(function(e){p(!1)})}}})):"")),n.attachments.length?wp.element.createElement("div",{className:"vibebp_reply_attachments"},n.attachments.map(function(e){return wp.element.createElement("div",{className:"vibebp_reply_attachment"},"image"==e.key?wp.element.createElement("a",{href:e.value,target:"_blank"},wp.element.createElement("img",{src:e.value})):wp.element.createElement("a",{href:e.value,target:"_blank",className:"vicon vicon-link"}))})):"",i?wp.element.createElement("div",{className:"update_reply_container"},wp.element.createElement(D,{reply:n,update:function(e){l(!1),r(e),document.dispatchEvent(new Event("VibeBP_Editor_Content"))}})):wp.element.createElement("div",{dangerouslySetInnerHTML:{__html:n.post_content}}))):""},V=(0,wp.element.createContext)({});function Z(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(n,!0).forEach(function(t){K(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var W=wp.element,X=(W.createElement,W.useState),Y=W.useEffect,$=W.useContext,ee=W.Fragment,te=wp.data,ne=te.dispatch,re=te.select,ae=function(e){var t=Q(X(!1),2),n=t[0],r=t[1],a=Q(X([]),2),o=a[0],i=a[1],l=Q(X({post_title:"",post_content:"",forum_id:0,priorities:[]}),2),c=l[0],s=l[1],p=Q(X({paged:1,s:""}),2),u=p[0],m=p[1],d=Q(X(G({},u)),2),f=d[0],w=(d[1],Q(X(!1),2)),v=w[0],b=w[1],h=Q(X(null),2),g=h[0],y=h[1],_=$(V);Y(function(){g&&g.abort();var e={},t=new AbortController;g&&(e={signal:t.signal}),y(t),b(!0);var n=u.s!=f.s?"?no_cache&args=".concat(encodeURIComponent(JSON.stringify(u))):"?args=".concat(encodeURIComponent(JSON.stringify(u))),r=1==u.paged?[]:Z(o);i(r),fetch("".concat(window.helpdesk.api.url,"/bbp/forums").concat(n),G({method:"post"},e,{body:JSON.stringify(G({},u,{token:re("vibebp").getToken()}))})).then(function(e){return e.json()}).then(function(e){b(!1),e.status&&i(e.forums)}).catch(function(e){"AbortError"===e.name?b(!1):console.error("Uh oh, an error!",e)})},[u]),Y(function(){e.hasOwnProperty("topic")&&s(G({},c,{},e.topic)),e.hasOwnProperty("forum_id")&&e.forum_id&&s(G({},c,{forum_id:e.forum_id}))},[]);return wp.element.createElement("div",{className:"vibebp_new_topic"},wp.element.createElement("div",{className:"vibebp_new_topic_header"},wp.element.createElement("span",{className:"vicon vicon-arrow-left",onClick:function(){return e.back()}}),wp.element.createElement("div",{className:"vibebp_topic_actions"},c&&c.hasOwnProperty("post_title")?wp.element.createElement("span",{className:"vicon vicon-trash",onClick:function(){s(G({},c,{post_title:"",post_content:""}))}}):"")),wp.element.createElement("div",{className:"vibebp_form"},wp.element.createElement("div",{className:"vibebp_form_field"},wp.element.createElement("input",{type:"text",value:c.post_title,placeholder:window.helpdesk.translations.topic_title,onChange:function(e){s(G({},c,{post_title:e.target.value}))}})),wp.element.createElement("div",{className:"vibebp_form_field select_forum"},wp.element.createElement("div",null,e.hasOwnProperty("forum_id")?"":wp.element.createElement(ee,null,wp.element.createElement("input",{type:"text",value:u.s,placeholder:window.helpdesk.translations.search_forum,onChange:function(e){m(G({},u,{paged:1,s:e.target.value}))}}),v?wp.element.createElement("span",{className:"is-loading button is-primary"}):"",o&&o.length?wp.element.createElement("select",{onChange:function(e){s(G({},c,{forum_id:e.target.value}))},value:c.forum_id,placeholder:window.helpdesk.translations.select_forum},wp.element.createElement("option",null,window.helpdesk.translations.select_forum),o.map(function(e){if(e.access)return wp.element.createElement("option",{value:e.id},e.title)})):""))),c.hasOwnProperty("priorities")&&_.priorities&&_.priorities.length?wp.element.createElement("div",{className:"vibebp_form_field select_priorities"},wp.element.createElement("label",null,window.helpdesk.translations.select_priority),wp.element.createElement("div",{className:"topic_priorities_wrapper"},_.priorities.map(function(e){var t=e.term_id,n=e.name,r=e.color;return wp.element.createElement("span",{className:c.priorities.includes(t)?"active":"",onClick:function(){var e=G({},c),n=c.priorities.indexOf(t);n>-1?e.priorities.splice(n,1):e.priorities.push(t),s(e)},style:{background:r}},n)}))):"",wp.element.createElement("div",{className:"vibebp_form_field"},wp.element.createElement("textarea",{value:c.post_content,placeholder:window.helpdesk.translations.topic_content,onChange:function(e){s(G({},c,{post_content:e.target.value}))}})),c.post_title&&c.forum_id&&c.post_content?wp.element.createElement("a",{className:n?"button is-primary is-loading":"button is-primary",onClick:function(){r(!0);var t="?post&args=".concat(encodeURIComponent(JSON.stringify(G({},c))));fetch("".concat(window.helpdesk.api.url,"/bbp/topics/create").concat(t),{method:"post",body:JSON.stringify(G({},c,{token:re("vibebp").getToken()}))}).then(function(e){return e.json()}).then(function(t){r(!1),t.status?(e.hasOwnProperty("update")&&e.update(c),e.hasOwnProperty("add")&&e.add(t.data),e.hasOwnProperty("forum_id")||e.back("mytopics")):t.hasOwnProperty("message")&&ne("vibebp").addNotification({text:t.message})})}},window.helpdesk.translations.submit):""))};function oe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var ie=wp.element,le=(ie.createElement,ie.useState),ce=ie.useEffect,se=wp.data,pe=se.dispatch,ue=se.select,me=function(e){var t=oe(le(),2),n=t[0],r=t[1],a=oe(le(!1),2),o=a[0],i=a[1];return ce(function(){e.id&&(i(!0),fetch("".concat(window.helpdesk.api.url,"/bbp/user-info"),{method:"post",body:JSON.stringify({topic_id:e.id,token:ue("vibebp").getToken()})}).then(function(e){return e.json()}).then(function(e){i(!1),e.status&&e.info&&r(e.info),e.hasOwnProperty("message")&&pe("vibebp").addNotification({text:e.message})}).catch(function(e){console.log(e),i(!1)}))},[]),ce(function(){n&&n.post_content&&document.dispatchEvent(new Event("VibeBP_Editor_Content"))},[n]),wp.element.createElement("div",{className:"user_info_wrapper"},wp.element.createElement("div",{className:"new_vhd_sidebar_wrapper"},wp.element.createElement("h3",{className:"info_title"},window.helpdesk.translations.user_info),o?wp.element.createElement("div",{class:"loading-roller"},wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null)):"",n?wp.element.createElement("div",{dangerouslySetInnerHTML:{__html:n.post_content}}):wp.element.createElement("div",{className:"vbp_message"},window.helpdesk.translations.no_info)))};function de(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function we(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fe(n,!0).forEach(function(t){ve(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fe(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var he=wp.element,ge=(he.createElement,he.useState),ye=he.useEffect,_e=wp.data,Ee=_e.dispatch,Oe=_e.select,ke=function(e){var t=be(ge({id:e.id,post_content:""}),2),n=t[0],r=t[1],a=be(ge({saving:!1,getting:!1}),2),o=a[0],i=a[1],l=be(ge([]),2),c=l[0],s=l[1];ye(function(){e.id&&(i(we({},o,{getting:!0})),fetch("".concat(window.helpdesk.api.url,"/bbp/topics/notes"),{method:"post",body:JSON.stringify({id:e.id,token:Oe("vibebp").getToken()})}).then(function(e){return e.json()}).then(function(e){i(we({},o,{getting:!1})),e.status&&s(e.data),e.hasOwnProperty("message")&&Ee("vibebp").addNotification({text:e.message})}).catch(function(e){console.log(e),i(we({},o,{getting:!1}))}))},[]);return wp.element.createElement("div",{className:"topic_notes_wrapper vibebp_form"},wp.element.createElement("div",{className:"new_vhd_sidebar_wrapper"},wp.element.createElement("h3",{className:"info_title"},window.helpdesk.translations.notes),wp.element.createElement("div",null,wp.element.createElement("div",{className:"vibebp_form_field"},wp.element.createElement("textarea",{value:n.post_content,placeholder:window.helpdesk.translations.add_topic_info,onChange:function(e){return r(we({},n,{post_content:e.target.value}))}})),wp.element.createElement("div",{className:"form_action"},n.post_content?wp.element.createElement("a",{className:o.saving?"is-loading button is-primary vicon vicon-save":"button is-primary vicon vicon-save",onClick:function(){n.post_content&&(i(we({},o,{saving:!0})),fetch("".concat(window.helpdesk.api.url,"/bbp/topics/notes/create"),{method:"post",body:JSON.stringify(we({},n,{token:Oe("vibebp").getToken()}))}).then(function(e){return e.json()}).then(function(e){i(we({},o,{saving:!1})),e.status&&s([e.data].concat(de(c))),e.hasOwnProperty("message")&&Ee("vibebp").addNotification({text:e.message})}).catch(function(e){console.log(e),i(we({},o,{saving:!1}))}))}}):"")),o.getting?wp.element.createElement("div",{class:"loading-roller"},wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null)):"",wp.element.createElement("div",{className:"vhd_notes_wrapper"},c&&c.length?c.map(function(e,t){return wp.element.createElement("div",{key:e.meta_id},wp.element.createElement("div",{dangerouslySetInnerHTML:{__html:e.meta_value}}),wp.element.createElement("span",{className:"vicon vicon-trash",onClick:function(){return function(e){var t=c[e].meta_id,n=de(c),r=de(c);r.splice(e,1),s(r),fetch("".concat(window.helpdesk.api.url,"/bbp/topics/notes/delete"),{method:"post",body:JSON.stringify({meta_id:t,token:Oe("vibebp").getToken()})}).then(function(e){return e.json()}).then(function(e){e.status||s(n),e.hasOwnProperty("message")&&Ee("vibebp").addNotification({text:e.message})}).catch(function(e){console.log(e)})}(t)}}))}):wp.element.createElement("div",{className:"vbp_message"},window.helpdesk.translations.no_notes))))};function Ne(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(n,!0).forEach(function(t){Se(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ce(e){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ae(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Ie=wp.element,xe=(Ie.createElement,Ie.useState),Te=Ie.useEffect,De=Ie.Fragment,Je=Ie.useContext,Le=wp.data,Ue=Le.dispatch,Re=Le.select,Me=function(e){var t=Ae(xe(e.topic),2),n=t[0],r=t[1],a=Ae(xe(!1),2),o=a[0],i=a[1],l=Ae(xe([]),2),c=l[0],s=l[1],p=Ae(xe(!0),2),m=p[0],d=p[1],f=Ae(xe({id:0,post_content:"",raw:"",topic_id:e.topic.id,forum_id:e.topic.forum_id,meta:[]}),2),w=f[0],v=(f[1],Ae(xe(!1),2)),b=v[0],h=v[1],g=Ae(xe({paged:1,post_parent:0,order:"DESC",s:""}),2),y=g[0],_=g[1],E=Re("vibebp").getUser(),O=Ae(xe(null),2),k=O[0],N=O[1],j=Ae(xe({user:!1,topic:!1}),2),P=j[0],S=j[1],C=Je(V);Te(function(){if("object"===Ce(e.topic))console.log("object"),r(e.topic),_(Pe({},y,{post_parent:e.topic.id})),d(!1);else{_(Pe({},y,{post_parent:e.topic}));var t="?args=".concat(encodeURIComponent(JSON.stringify({topic_id:e.topic})));fetch("".concat(window.helpdesk.api.url,"/bbp/topic").concat(t),{method:"post",body:JSON.stringify({topic_id:e.topic,token:Re("vibebp").getToken()})}).then(function(e){return e.json()}).then(function(t){t.status&&(d(!1),r(t.topic),_(Pe({},y,{post_parent:e.topic.id})))})}},[]),Te(function(){if(y.post_parent){k&&k.abort();var e=new AbortController,t=k?{signal:e.signal}:{};N(e),d(!0);var n=y.s.length?"?nocache":"?args=".concat(encodeURIComponent(JSON.stringify(Pe({},y,{s:""})))),r=1!=y.paged||y.s?Ne(c):[];s(r),fetch("".concat(window.helpdesk.api.url,"/bbp/replies").concat(n),Pe({method:"post"},t,{body:JSON.stringify(Pe({},y,{token:Re("vibebp").getToken()}))})).then(function(e){return e.json()}).then(function(e){if(d(!1),e.status){r=1==y.paged?[]:Ne(c);var t=[].concat(Ne(r),Ne(e.replies));h(t.length<parseInt(e.total)),s(t)}e.hasOwnProperty("message")&&Ue("vibebp").addNotification({text:e.message})}).catch(function(e){d(!1),"AbortError"===e.name||(N(null),console.error("Uh oh, an error!",e))})}},[y]);var A=function(){_(Pe({},y,{s:""}))};return Te(function(){return document.addEventListener("vibebp_component_reload",A),function(){document.removeEventListener("vibebp_component_reload",A)}}),Te(function(){document.dispatchEvent(new Event("VibeBP_Editor_Content"))},[c]),wp.element.createElement("div",{className:"vibebp_full_topic"},o?wp.element.createElement(ae,{back:function(){i(!1)},topic:n,update:function(t){r(t),e.update(t)}}):wp.element.createElement("div",null,wp.element.createElement("div",{className:"vibebp_full_topic_header"},wp.element.createElement("span",{onClick:e.back},wp.element.createElement("span",{className:"vicon vicon-arrow-left"}),wp.element.createElement("span",null,window.helpdesk.translations.back_to_all_topics)),wp.element.createElement("div",{className:"vibebp_topic_actions"},wp.element.createElement("span",{dangerouslySetInnerHTML:{__html:n.last_update}}),n.hasOwnProperty("author")&&n.author==E.id?wp.element.createElement(De,null,wp.element.createElement("span",{className:"vicon vicon-pencil",onClick:function(){i(n)}}),wp.element.createElement("span",{className:"vicon vicon-trash",onClick:function(){e.delete(n)}})):"",window.helpdesk.settings.helpdesk&&[window.helpdesk.settings.assigned_tickets.id,window.helpdesk.settings.resolved_tickets.id,window.helpdesk.settings.assign_tickets.id].includes(C.activeTab)?wp.element.createElement("a",{className:"vicon vicon-menu",onClick:function(){S(Pe({},P,{topic:!P.topic}))}}):"")),wp.element.createElement("div",{className:"vibebp_main_topic_wrapper"},wp.element.createElement("div",null,wp.element.createElement("div",{className:"vibebp_main_topic"},wp.element.createElement(u,{type:"member",id:{user_id:n.author}}),wp.element.createElement("div",{dangerouslySetInnerHTML:{__html:n.post_content}})),wp.element.createElement(D,{reply:w,update:function(e){var t=Ne(c);t.unshift(e),s(t)}}),wp.element.createElement(De,null,c.length?c.map(function(e,t){if(parseInt(e.id)!==parseInt(e.topic_id))return wp.element.createElement(B,{key:"rep_"+t,reply:e,delete:function(){var e=Ne(c);e.splice(t,1),s(e)}})}):"",m?wp.element.createElement("div",{class:"loading-roller"},wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null)):"",b?wp.element.createElement("a",{className:"link",onClick:function(){var e=Pe({},y);e.paged=y.paged+1,_(e)}},window.helpdesk.translations.more):"")),P.topic?wp.element.createElement("div",{className:"topic_extended_info"},wp.element.createElement("div",null,wp.element.createElement("a",{className:"button is-primary",style:{width:"100%"},onClick:function(){return S(Pe({},P,{user:!P.user}))}},P.user?window.helpdesk.translations.hide_user_info:window.helpdesk.translations.show_user_info),P.user?wp.element.createElement(me,{id:n.id,close:function(){return S({topic:!1,user:!1})}}):""),wp.element.createElement(ke,{id:n.id})):"")))};function He(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fe(n,!0).forEach(function(t){Be(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fe(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Be(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ve(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Ze=wp.element,ze=(Ze.createElement,Ze.useState),Ge=wp.data,Ke=Ge.dispatch,Qe=Ge.select;function We(e){var t=Ve(ze(e.assigned_agents),2),n=t[0],r=t[1],a=Ve(ze(!1),2),o=a[0],i=a[1],l=Ve(ze(""),2),c=l[0],s=l[1],p=Ve(ze([]),2),d=p[0],f=p[1],w=Ve(ze({users:!1,assign:!1,unassign:!1}),2),v=w[0],b=w[1],h=Ve(ze([]),2),g=h[0],y=h[1],_=Ve(ze(null),2),E=_[0],O=_[1];m(function(){E&&E.abort();var e=new AbortController,t=E?{signal:e.signal}:{};if(O(e),c.length>2){b(qe({},v,{users:!0}));var n=c.length?"?nocache":"";fetch("".concat(window.helpdesk.api.url,"/bbp/search").concat(n),qe({method:"post"},t,{body:JSON.stringify({s:c,token:Qe("vibebp").getToken()})})).then(function(e){return e.json()}).then(function(e){b(qe({},v,{users:!1})),f(e.users?e.users:[])}).catch(function(e){b(qe({},v,{users:!0}))})}},500,[c]);var k=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"assign",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=He("assign"===t?g:a);if(o.length){var i={user_ids:o,action:t,topic_id:e.topic_id},l="?post&args=".concat(encodeURIComponent(JSON.stringify(qe({},i))));b(qe({},v,Be({},t,!0))),"unassign"===t&&r(He(n).filter(function(e){return!o.includes(e)})),fetch("".concat(window.helpdesk.api.url,"/bbp/topics/assign_topic").concat(l),{method:"post",body:JSON.stringify(qe({},i,{token:Qe("vibebp").getToken()}))}).then(function(e){return e.json()}).then(function(e){b(qe({},v,Be({},t,!1))),e.status&&"assign"===t&&(r([].concat(He(n),He(o))),y([])),e.hasOwnProperty("message")&&Ke("vibebp").addNotification({text:e.message})}).catch(function(e){b(qe({},v,{users:!0}))})}};return wp.element.createElement("div",{className:"assign_user_wrapper"},wp.element.createElement("label",null,window.helpdesk.translations.assigned_agents),wp.element.createElement("div",{className:"assigned_user_wrapper"},n&&Array.isArray(n)&&n.map(function(e){return wp.element.createElement("span",{className:"assigned_user"},wp.element.createElement("span",{className:"vicon vicon-close",onClick:function(){k("unassign",[e])}}),wp.element.createElement(u,{type:"member",id:{user_id:parseInt(e)}}))}),o?wp.element.createElement("span",{className:"assign_agent_form"},wp.element.createElement("div",{className:v.users?"control vibebp_form_field is-loading":"control vibebp_form_field"},wp.element.createElement("input",{type:"text",placeholder:window.helpdesk.translations.search_u,onChange:function(e){return s(e.target.value)}}),wp.element.createElement("span",{className:"vicon vicon-close",onClick:function(){return i(!o)}})),wp.element.createElement("div",{className:"fetched_users"},d?d.map(function(e){if(!n.includes(e.id))return wp.element.createElement("span",{className:g.includes(e.id)?"active":"",onClick:function(){var t=He(g),n=t.findIndex(function(t){return e.id===t});-1===n?y([].concat(He(t),[e.id])):(t.splice(n,1),y(t))}},e.label)}):"",g.length?wp.element.createElement("a",{className:v.assign?"button is-primary vicon vicon-share is-loading":"button is-primary vicon vicon-share",onClick:function(){return k("assign")}}):"")):wp.element.createElement("span",{className:"vicon vicon-plus",onClick:function(){return i(!o)}})))}function Xe(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function $e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ye(n,!0).forEach(function(t){et(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ye(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function et(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var nt=wp.element,rt=(nt.createElement,nt.useState),at=nt.useEffect,ot=nt.Fragment,it=nt.useContext,lt=wp.data,ct=lt.dispatch,st=lt.select,pt=function(e){var t=tt(rt(!1),2),n=t[0],r=t[1],a=tt(rt({type:e.type,sorter:"",paged:1,s:"",order:"DESC",priorities:[]}),2),o=a[0],i=a[1],l=tt(rt([]),2),c=l[0],s=l[1],p=tt(rt(!1),2),d=p[0],f=p[1],w=tt(rt(!1),2),v=w[0],b=w[1],h=tt(rt(0),2),g=h[0],y=h[1],_=tt(rt(!1),2),E=_[0],O=(_[1],tt(rt(!1),2)),k=O[0],N=O[1],j=st("vibebp").getUser(),P=tt(rt(null),2),S=P[0],C=P[1],A=it(V),I=tt(rt(!1),2),x=I[0],T=I[1];at(function(){e.hasOwnProperty("forum")&&N(e.forum.subscribed)},[]);var D=function(){i($e({},o,{s:""}))};at(function(){return document.addEventListener("vibebp_component_reload",D),function(){document.removeEventListener("vibebp_component_reload",D)}}),m(function(){S&&S.abort();var t=new AbortController,n=S?{signal:t.signal}:{};C(t),r(!0);var a=1==o.paged?[]:Xe(c);s(a),f(!1);var i=$e({},o,{type:e.type});"forum"===e.type&&(i.post_parent=e.forum.id),e.label&&(i.label=e.label);var l=o.s.length?"?nocache":"?args=".concat(encodeURIComponent(JSON.stringify(i)));fetch("".concat(window.helpdesk.api.url,"/bbp/topics").concat(l),$e({method:"post"},n,{body:JSON.stringify($e({},i,{token:st("vibebp").getToken()}))})).then(function(e){return e.json()}).then(function(e){if(r(!1),e.status){a=1==o.paged?[]:Xe(c);var t=[].concat(Xe(a),Xe(e.topics));f(t.length<parseInt(e.total)),s(t)}}).catch(function(e){"AbortError"===e.name||(C(null),console.error("Uh oh, an error!",e))})},500,[o,e.type,e.label]);var J=function(e){var t=Xe(c),n=t.findIndex(function(t,n){return t.id==e.id});n>-1?t.splice(n,1,e):t.push(e),s(t)},L=function(e){var t=Xe(c),n="?post&args=".concat(encodeURIComponent(JSON.stringify({topic_id:e.id})));fetch("".concat(window.helpdesk.api.url,"/bbp/topics/delete").concat(n),{method:"post",body:JSON.stringify({topic_id:e.id,token:st("vibebp").getToken()})}).then(function(e){return e.json()}).then(function(n){n.status&&(t.splice(t.findIndex(function(t){return e.id==t.id}),1),s(t),y(!1)),n.hasOwnProperty("message")&&ct("vibebp").addNotification({text:n.message})})},U=Xe(c);return o.s.length&&(U=c.filter(function(e){return e.post_title.toLowerCase().indexOf(o.s.toLowerCase())>-1})),wp.element.createElement("div",{className:"vibebp_topics"},e.hasOwnProperty("forum")?wp.element.createElement("div",{className:"vibebp_topics_header"},wp.element.createElement("span",{onClick:e.back},wp.element.createElement("span",{className:"vicon vicon-arrow-left"}),wp.element.createElement("span",null,window.helpdesk.translations.back_to_all_topics)),wp.element.createElement("span",{className:k?"subscribe active":"subscribe",onClick:function(){var t;t="?post&args=".concat(encodeURIComponent(JSON.stringify({forum_id:e.forum.id}))),fetch("".concat(window.helpdesk.api.url,"/bbp/topics/subscribe").concat(t),{method:"post",body:JSON.stringify({forum_id:e.forum.id,subscribe:!k,token:st("vibebp").getToken()})}).then(function(e){return e.json()}).then(function(e){e.status&&N(!k)})}},k?window.helpdesk.translations.subscribed:window.helpdesk.translations.subscribe)):"",g?"":wp.element.createElement("div",{className:"vibebp_full_topics_header"},wp.element.createElement("div",{className:"vibebp_form_field"},wp.element.createElement("div",{className:E?"search_me control is-loading":"search_me"},wp.element.createElement("input",{type:"text",value:o.s,onChange:function(e){i({paged:1,s:e.target.value})},placeholder:window.helpdesk.translations.search_topics}),wp.element.createElement("span",{className:"vicon vicon-search"}))),A.priorities&&A.priorities.length?wp.element.createElement("div",{className:"vibebp_form_field select_priorities"},wp.element.createElement("div",{className:"topic_priorities_wrapper"},A.priorities.map(function(e){var t=e.term_id,n=e.name,r=e.color;return wp.element.createElement("span",{className:o.priorities.includes(t)?"active":"",onClick:function(){var e=$e({},o),n=o.priorities.indexOf(t);n>-1?e.priorities.splice(n,1):e.priorities.push(t),i($e({},e,{paged:1}))},style:{background:r}},n)}))):""),g?wp.element.createElement(Me,{topic:g,back:function(){y(!1)},update:J,delete:L}):v?wp.element.createElement(ae,{back:function(){b(!1)},topic:c[v],update:J}):wp.element.createElement(ot,null,x?wp.element.createElement(ae,{forum_id:e.hasOwnProperty("forum")&&e.forum.hasOwnProperty("id")?e.forum.id:null,back:function(){T(!1)},add:function(e){var t=Xe(c);t.unshift(e),s(t)}}):e.hasOwnProperty("forum")&&e.forum.hasOwnProperty("id")?wp.element.createElement("a",{className:"button is-primary",onClick:function(){T(!0)}},window.helpdesk.translations.new_topic):"",U.length?U.map(function(t,n){return wp.element.createElement("div",{className:"vibebp_topic_wrapper"},wp.element.createElement(u,{type:"member",id:{user_id:t.author}}),wp.element.createElement("div",{className:"vibebp_topic"},wp.element.createElement("div",{className:"vibebp_topic_title"},wp.element.createElement("strong",{onClick:function(){y(t)}},wp.element.createElement("div",{dangerouslySetInnerHTML:{__html:t.post_title}})),wp.element.createElement("span",null,wp.element.createElement("span",{className:t.favorite?"vicon vicon-star active":"vicon vicon-star",onClick:function(){!function(e){var t="?post&args=".concat(encodeURIComponent(JSON.stringify({topic_id:e.id})));e.favorite?fetch("".concat(window.helpdesk.api.url,"/bbp/topics/unfavorite").concat(t),{method:"post",body:JSON.stringify({topic_id:e.id,token:st("vibebp").getToken()})}).then(function(e){return e.json()}).then(function(t){if(t.status){var n=Xe(c);n[n.findIndex(function(t){return t.id===e.id})].favorite=!1,s(n)}t.hasOwnProperty("message")&&ct("vibebp").addNotification({text:t.message})}):fetch("".concat(window.helpdesk.api.url,"/bbp/topics/favorite").concat(t),{method:"post",body:JSON.stringify({topic_id:e.id,token:st("vibebp").getToken()})}).then(function(e){return e.json()}).then(function(t){if(t.status){var n=Xe(c);n[n.findIndex(function(t){return t.id===e.id})].favorite=!0,s(n)}t.hasOwnProperty("message")&&ct("vibebp").addNotification({text:t.message})})}(t)}}),wp.element.createElement("span",{className:t.subscribed?"subscribe active":"subscribe",onClick:function(){!function(e){var t="?post&args=".concat(encodeURIComponent(JSON.stringify({topic_id:c[e].id})));fetch("".concat(window.helpdesk.api.url,"/bbp/topics/subscribe").concat(t),{method:"post",body:JSON.stringify({topic_id:c[e].id,subscribe:!c[e].subscribed,token:st("vibebp").getToken()})}).then(function(e){return e.json()}).then(function(t){if(t.status){var n=Xe(c);n[e].subscribed=!n[e].subscribed,s(n)}else t.hasOwnProperty("message")&&ct("vibebp").addNotification({text:t.message})})}(n)}},t.subscribed?window.helpdesk.translations.subscribed:window.helpdesk.translations.subscribe),t.is_resolved?wp.element.createElement("span",{className:"subscribe active"},window.helpdesk.translations.resolved):"","assigned"===e.type||"resolved"===e.type||e.can_assign?wp.element.createElement("span",{className:t.resolved?"subscribe active":"subscribe",onClick:function(){!function(e){var t="?post&args=".concat(encodeURIComponent(JSON.stringify({topic_id:c[e].id}))),n=c[e].resolved?"unresolve":"resolve";fetch("".concat(window.helpdesk.api.url,"/bbp/topic/resolve").concat(t),{method:"post",body:JSON.stringify({topic_id:c[e].id,action:n,token:st("vibebp").getToken()})}).then(function(e){return e.json()}).then(function(t){if(t.status){var n=Xe(c);n[e].resolved=!n[e].resolved,s(n)}t.hasOwnProperty("message")&&ct("vibebp").addNotification({text:t.message})})}(n)}},(t.resolved,window.helpdesk.translations.resolved)):"",wp.element.createElement("span",{className:"vicon vicon-comment-alt",onClick:function(){y(t)}}),wp.element.createElement("strong",{onClick:function(){y(t)}},t.reply_count))),wp.element.createElement("div",{className:"vibebp_topic_actions"},wp.element.createElement("a",{href:t.permalink,target:"_blank",className:"vicon vicon-link"}),wp.element.createElement("span",null,wp.element.createElement("div",{dangerouslySetInnerHTML:{__html:t.last_update}})),j.id===parseInt(t.author)?wp.element.createElement(ot,null,wp.element.createElement("span",{className:"vicon vicon-pencil",onClick:function(){b(n)}}),wp.element.createElement("span",{className:"vicon vicon-trash",onClick:function(){L(t)}})):""),"unassigned"==e.type||"recent_assigned"==e.type?wp.element.createElement(We,{assigned_agents:t.assigned_agents,topic_id:t.id}):""))}):wp.element.createElement("div",{className:"vbp_message"},window.helpdesk.translations.no_topics_found),n?wp.element.createElement("div",{class:"loading-roller"},wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null)):"",d?wp.element.createElement("a",{className:"link",onClick:function(){f(!1);var e=$e({},o);e.paged=o.paged+1,i(e)}},window.helpdesk.translations.more):""))};function ut(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function mt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mt(n,!0).forEach(function(t){ft(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mt(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ft(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var vt=wp.element,bt=(vt.createElement,vt.useState),ht=vt.useEffect,gt=vt.Fragment,yt=(vt.render,wp.data),_t=yt.dispatch,Et=yt.select,Ot=function(e){var t=wt(bt(!0),2),n=t[0],r=t[1],a=wt(bt([]),2),o=a[0],i=a[1],l=wt(bt(!1),2),c=l[0],s=l[1],p=wt(bt({paged:1,s:""}),2),u=p[0],f=p[1],w=wt(bt(!1),2),v=w[0],b=w[1],h=wt(bt(!1),2),g=h[0],y=(h[1],wt(bt(null),2)),_=y[0],E=y[1];ht(function(){if("forums"==Et("vibebp").getAction()&&Et("vibebp").getId()){var e=Et("vibebp").getId();e&&f(dt({},u,{post__in:[e]}))}},[]);var O=function(){f(dt({},u,{s:""}))};ht(function(){return document.addEventListener("vibebp_component_reload",O),function(){document.removeEventListener("vibebp_component_reload",O)}}),m(function(){_&&_.abort();var e=new AbortController,t=_?{signal:e.signal}:{};E(e),r(!0);var n=u.s.length?"?nocache":"?args=".concat(encodeURIComponent(JSON.stringify(dt({},u,{s:""})))),a=1==u.paged?[]:ut(o);i(a),fetch("".concat(window.helpdesk.api.url,"/bbp/forums").concat(n),dt({method:"post"},t,{body:JSON.stringify(dt({},u,{token:Et("vibebp").getToken()}))})).then(function(e){return e.json()}).then(function(e){if(r(!1),e.status&&e.forums){a=1==u.paged?[]:ut(o);var t=[].concat(ut(a),ut(e.forums));i(t),b(t.length<parseInt(e.total))}}).catch(function(e){r(!1),"AbortError"===e.name||(E(null),console.error("Uh oh, an error!",e))})},500,[u]);var k=function(e){var t={subscribe:!o[e].subscribed,forum_id:o[e].id},n="?post&args=".concat(encodeURIComponent(JSON.stringify(dt({},u))));fetch("".concat(window.helpdesk.api.url,"/bbp/forums/subscribe").concat(n),{method:"post",body:JSON.stringify(dt({},t,{token:Et("vibebp").getToken()}))}).then(function(e){return e.json()}).then(function(t){if(t.status){var n=ut(o);n[e].subscribed=!o[e].subscribed,i(n)}else t.hasOwnProperty("message")&&_t("vibebp").addNotification({text:t.message})})},N=ut(o);return u.s.length&&(N=o.filter(function(e){return e.title.toLowerCase().indexOf(u.s.toLowerCase())>-1})),wp.element.createElement("div",{className:"vibebp_forums"},c?wp.element.createElement(pt,{type:"forum",forum:c,back:function(){if(s(!1),u.post__in){var e=dt({},u);delete e.post__in,f(e)}}}):wp.element.createElement(gt,null,wp.element.createElement("div",{className:"vibebp_form_field"},wp.element.createElement("div",{className:g?"search_me control is-loading":"search_me"},wp.element.createElement("input",{type:"text",value:u.s,onChange:function(e){f({paged:1,s:e.target.value})},placeholder:window.helpdesk.translations.search_text}),wp.element.createElement("span",{className:"vicon vicon-search"}))),n?wp.element.createElement("div",{class:"loading-roller"},wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null)):wp.element.createElement(gt,null,N.length?N.map(function(e,t){return wp.element.createElement("div",{className:"vibebp_forum"},wp.element.createElement("div",{className:"vibebp_forum_details"},wp.element.createElement("strong",{onClick:function(){e.access&&s(e)}},wp.element.createElement("div",{dangerouslySetInnerHTML:{__html:e.title}})),wp.element.createElement("div",{className:"vibebp_forum_description",dangerouslySetInnerHTML:{__html:e.description}}),wp.element.createElement("div",{className:"vibebp_forum_meta"},e.private?wp.element.createElement("span",{className:"vicon vicon-key"}):"",e.subscribed?wp.element.createElement("span",{onClick:function(){k(t)},className:"active subscribe"},window.helpdesk.translations.subscribed):wp.element.createElement("span",{onClick:function(){k(t)},className:"subscribe"},window.helpdesk.translations.subscribe),e.access?wp.element.createElement("span",{className:"vicon vicon-eye"}):wp.element.createElement("span",{className:"vicon vicon-na"}),e.forums_count?wp.element.createElement("span",null,wp.element.createElement("span",{className:"vicon vicon-comment-alt"})," ",e.forums_count):"",e.hasOwnProperty("forums")&&e.forums.length?wp.element.createElement("div",{class:"sub_forums"},e.forums.map(function(e){return wp.element.createElement(d,{forum:e})})):"")),wp.element.createElement("div",{className:"vibebp_topic_count"},wp.element.createElement("span",{className:"vicon vicon-comments"}),e.topic_count))}):wp.element.createElement("div",{className:"vbp_message"},window.helpdesk.translations.no_forums_found),v?wp.element.createElement("a",{className:"link",onClick:function(){var e=dt({},u);e.paged=u.paged+1,f(e)}},window.helpdesk.translations.more):"")))};function kt(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function jt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nt(n,!0).forEach(function(t){Pt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nt(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function St(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Ct=wp.element,At=(Ct.createElement,Ct.useState),It=Ct.useEffect,xt=Ct.Fragment,Tt=(Ct.render,wp.data),Dt=(Tt.dispatch,Tt.select),Jt=function(e){var t=St(At({type:e.type,sorter:"",paged:1,s:"",order:"DESC"}),2),n=t[0],r=t[1],a=St(At(!1),2),o=a[0],i=a[1],l=St(At([]),2),c=l[0],s=l[1],p=St(At(!0),2),u=(p[0],p[1]),d=St(At(!1),2),f=d[0],w=d[1],v=St(At(0),2),b=v[0],h=v[1],g=St(At(!1),2),y=g[0],_=(g[1],St(At(null),2)),E=_[0],O=_[1],k=function(){r(jt({},n,{s:""}))};It(function(){return document.addEventListener("vibebp_component_reload",k),function(){document.removeEventListener("vibebp_component_reload",k)}}),m(function(){E&&E.abort();var e=new AbortController,t=E?{signal:e.signal}:{};O(e),i(!0);var r=n.s.length?"?nocache":"?args=".concat(encodeURIComponent(JSON.stringify(jt({},n,{s:""})))),a=1!=n.paged||n.s?kt(c):[];s(a),fetch("".concat(window.helpdesk.api.url,"/bbp/replies").concat(r),jt({method:"post"},t,{body:JSON.stringify(jt({},n,{token:Dt("vibebp").getToken()}))})).then(function(e){return e.json()}).then(function(e){if(i(!1),e.status){a=1==n.paged?[]:kt(c);var t=[].concat(kt(a),kt(e.replies));w(t.length<parseInt(e.total)),s(t)}}).catch(function(e){i(!1),"AbortError"===e.name||(O(null),console.error("Uh oh, an error!",e))})},500,[n]);var N=function(){},j=kt(c);return n.s.length&&(j=c.filter(function(e){return e.post_content.toLowerCase().indexOf(n.s.toLowerCase())>-1})),It(function(){document.dispatchEvent(new Event("VibeBP_Editor_Content"))},[c]),wp.element.createElement(xt,null,b?wp.element.createElement(Me,{topic:b,back:function(){h(!1)}}):wp.element.createElement("div",{className:"vibebp_replies"},wp.element.createElement("div",{className:"vibebp_form_field"},wp.element.createElement("div",{className:y?"search_me control is-loading":"search_me"},wp.element.createElement("input",{type:"text",value:n.s,onChange:function(e){r({paged:1,s:e.target.value})},placeholder:window.helpdesk.translations.search_replies}),wp.element.createElement("span",{className:"vicon vicon-search"}))),j&&j.length?j.map(function(e,t){return wp.element.createElement(B,{reply:e,update:N,open:function(){h(e.topic_id)},delete:function(){var t=kt(c),n=c.findIndex(function(t){return t.id===e.id});n>-1&&(t.splice(n,1),j=kt(t),s(t))}})}):wp.element.createElement("div",{className:"vbp_message"},window.helpdesk.translations.no_replies_found),o?wp.element.createElement("div",{class:"loading-roller"},wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null)):"",f?wp.element.createElement("a",{className:"link",onClick:function(){w(!1);var e=jt({},n);e.paged=n.paged+1,u(!0),r(e)}},window.helpdesk.translations.more):""))};function Lt(){return(Lt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ut(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Rt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Mt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Ht=wp.element.useState,Ft=function(e){var t=Mt(Ht({scope:Object.keys(window.helpdesk.settings.shared_tabs)[0]}),2),n=t[0],r=t[1];return wp.element.createElement("div",{className:"vibe_assign_topic_wrapper"},wp.element.createElement("div",{className:"vibe_assign_topic_header"},wp.element.createElement("div",{class:"buttons has-addons"},Object.keys(window.helpdesk.settings.shared_tabs).map(function(e){return wp.element.createElement("button",{className:n.scope==e?"button is-success is-selected":"button",onClick:function(t){r(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ut(n,!0).forEach(function(t){Rt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ut(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},n,{scope:e}))}},window.helpdesk.settings.shared_tabs[e])}))),"unassigned"===n.scope?wp.element.createElement(pt,Lt({type:"unassigned"},e)):wp.element.createElement(pt,Lt({type:"recent_assigned"},e)))};function qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Bt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qt(n,!0).forEach(function(t){Vt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qt(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Vt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Zt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var zt=wp.element,Gt=(zt.createElement,zt.useState),Kt=zt.useEffect,Qt=wp.data,Wt=Qt.dispatch,Xt=Qt.select,Yt=function(e){var t=Zt(Gt({id:"",post_title:""}),2),n=t[0],r=t[1],a=Zt(Gt({post_content:"",raw:""}),2),o=a[0],i=a[1],l=Zt(Gt("new_canned"),2),c=l[0],s=(l[1],Zt(Gt({saving:!1,search:!1}),2)),p=s[0],u=s[1];Kt(function(){if(e.response&&e.response.hasOwnProperty("ID")){var t=Bt({},n,{},e.response);t.id=e.response.ID,r(t)}},[e.response]),Kt(function(){var t=new CustomEvent("load_vibe_editor",{detail:{selector:".".concat(c),content:e.hasOwnProperty("response")&&e.response.post_content?e.response.post_content:"",raw:e.hasOwnProperty("response")&&e.response.raw?e.response.raw:"",components:"editor",updater:c}});document.dispatchEvent(t);var n=function(e){i(Bt({},o,{post_content:e.detail.raw_html,raw:e.detail.editor_content}))};return document.addEventListener("vibe_editor_content_update_".concat(c),n),function(){document.removeEventListener("vibe_editor_content_update_".concat(c),n)}},[]);return wp.element.createElement("div",{className:"vhd_sidebar"},wp.element.createElement("div",{className:"new_vhd_sidebar_overlay",onClick:e.close}),wp.element.createElement("div",{className:"new_vhd_sidebar_wrapper vibebp_form"},wp.element.createElement("div",{className:"vibebp_form_field"},wp.element.createElement("label",null,window.helpdesk.translations.enter_canned_title),wp.element.createElement("input",{value:n.post_title,placeholder:window.helpdesk.translations.enter_canned_title,onChange:function(e){return r(Bt({},n,{post_title:e.target.value}))}})),wp.element.createElement("div",{className:"vibebp_form_field"},wp.element.createElement("label",null,window.helpdesk.translations.enter_canned_content),wp.element.createElement("div",{className:c})),wp.element.createElement("div",{className:"form_action"},n.post_title&&o.post_content&&o.post_content.length?wp.element.createElement("a",{className:p.saving?"is-loading button is-primary vicon vicon-save":"button is-primary vicon vicon-save",onClick:function(){if(o.post_content&&n.post_title){u(Bt({},p,{saving:!0}));var t=Bt({},n,{},o),r="?args=".concat(encodeURIComponent(JSON.stringify(Bt({},t))));fetch("".concat(window.helpdesk.api.url,"/bbp/replies/save_canned").concat(r),{method:"post",body:JSON.stringify(Bt({},t,{token:Xt("vibebp").getToken()}))}).then(function(e){return e.json()}).then(function(t){u(Bt({},p,{saving:!1})),t.status&&(t.data.raw=o.raw,e.update&&e.update(t.data)),t.hasOwnProperty("message")&&Wt("vibebp").addNotification({text:t.message})}).catch(function(e){console.log(e),u(Bt({},p,{saving:!1}))})}}}):""),wp.element.createElement("a",{className:"link",onClick:e.close},window.helpdesk.translations.cancel)))};function $t(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function en(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?en(n,!0).forEach(function(t){nn(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):en(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function nn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var an=wp.element,on=(an.createElement,an.useState),ln=wp.data,cn=ln.dispatch,sn=ln.select,pn=function(){var e=rn(on({paged:1,s:"",orderby:"date",order:"DESC"}),2),t=e[0],n=e[1],r=rn(on(null),2),a=r[0],o=r[1],i=rn(on([]),2),l=i[0],c=i[1],s=rn(on(!1),2),p=s[0],u=s[1],d=rn(on(!1),2),f=d[0],w=d[1],v=rn(on(!1),2),b=v[0],h=v[1];m(function(){a&&a.abort();var e=new AbortController,n=a?{signal:e.signal}:{};o(e);var r=tn({},t),i=r.s.length?"?nocache":"?args=".concat(encodeURIComponent(JSON.stringify(tn({},r,{s:""})))),c=1==r.paged?[]:$t(l);g(c),u(!0),fetch("".concat(window.helpdesk.api.url,"/bbp/users/canned-responses").concat(i," "),tn({method:"post"},n,{body:JSON.stringify(tn({},t,{token:sn("vibebp").getToken()}))})).then(function(e){return e.json()}).then(function(e){if(u(!1),e.status){c=1==t.paged?[]:$t(l);var n=[].concat($t(c),$t(e.data));w(n.length<parseInt(e.total)),g(n)}}).catch(function(e){u(!1),"AbortError"!==e.name&&(o(null),console.error("Uh oh, an error!",e))})},500,[t]);var g=function(e){c(e)};return wp.element.createElement("div",{className:"canned_responses_wrapper"},wp.element.createElement("div",{className:"new_button_wrapper"},b?wp.element.createElement(Yt,{update:function(e){var t=$t(l),n=t.findIndex(function(t){return t.ID===e.ID});n>-1?t.splice(n,1,e):t.unshift(e),c(t)},response:b,close:function(){return h(!1)}}):wp.element.createElement("div",{className:"new_button"},wp.element.createElement("a",{className:"button is-primary vicon vicon-plus",onClick:function(){return h(!0)}}))),p?wp.element.createElement("div",{class:"loading-roller"},wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null)):"",l&&l.length?wp.element.createElement("div",{className:"canned_all_responses_wrapper"},l.map(function(e,t){return wp.element.createElement("div",{className:"canned_reponse_wrapper"},wp.element.createElement("div",{className:"canned_reponse_wrapper_header"},wp.element.createElement("div",{className:"response_date"},new Date(e.post_date).toLocaleDateString()),wp.element.createElement("div",{className:"canned_actions"},wp.element.createElement("span",{className:"vicon vicon-pencil",onClick:function(){return function(e){h(l[e])}(t)}}),wp.element.createElement("span",{className:"vicon vicon-trash",onClick:function(){return function(e){var t=$t(l),n=$t(l);n.splice(e,1),c(n),fetch("".concat(window.helpdesk.api.url,"/bbp/users/canned-responses/delete"),{method:"post",body:JSON.stringify({id:l[e].ID,token:sn("vibebp").getToken()})}).then(function(e){return e.json()}).then(function(e){e.status||c(t),e.hasOwnProperty("message")&&cn("vibebp").addNotification({text:e.message})}).catch(function(e){c(t),"AbortError"!==e.name&&console.error("Uh oh, an error!",e)})}(t)}}))),wp.element.createElement("div",null,e.post_title))})):wp.element.createElement("div",{className:"vbp_message"},window.helpdesk.translations.no_responses),f?wp.element.createElement("a",{className:"link",onClick:function(){n(tn({},t,{paged:t.paged+1}))}},window.helpdesk.translations.load_more):"")};function un(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?un(n,!0).forEach(function(t){dn(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):un(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function dn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var wn=wp.element,vn=(wn.createElement,wn.useState),bn=wn.useEffect,hn=wp.data,gn=hn.dispatch,yn=hn.select,_n=function(){var e=fn(vn({post_content:"",raw:""}),2),t=e[0],n=e[1],r=fn(vn({}),2),a=r[0],o=r[1],i=fn(vn(!1),2),l=i[0],c=i[1],s=fn(vn(!1),2),p=s[0],u=s[1],m=function(e){o({post_content:e.detail.raw_html,raw:e.detail.editor_content})};bn(function(){u(!0),fetch("".concat(window.helpdesk.api.url,"/bbp/user-info"),{method:"post",body:JSON.stringify({token:yn("vibebp").getToken()})}).then(function(e){return e.json()}).then(function(e){if(u(!1),e.info){n(e.info);var t=e.info,r=new CustomEvent("load_vibe_editor",{detail:{selector:".".concat("vibe_info_editor_"),content:t.hasOwnProperty("post_content")&&t.post_content?t.post_content:"",raw:t.hasOwnProperty("raw")&&t.raw?t.raw:"",components:"editor",updater:"".concat("vibe_info_editor_")}});document.dispatchEvent(r),document.addEventListener("vibe_editor_content_update_".concat("vibe_info_editor_"),m)}e.hasOwnProperty("message")&&gn("vibebp").addNotification({text:e.message})})},[]);return wp.element.createElement("div",{className:"myinfo_wrapper"},p?wp.element.createElement("div",{class:"loading-roller"},wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null)):"",wp.element.createElement("div",{style:{display:p?"none":"block"}},wp.element.createElement("div",{className:"".concat("vibe_info_editor_")},wp.element.createElement("textarea",{onChange:function(e){n(mn({},t,{post_content:e.target.value})),o(mn({},a,{post_content:e.target.value}))},value:t.post_content})),wp.element.createElement("div",{className:"vibebp_info_form_actions"},wp.element.createElement("div",{className:"vibebp_info_form_buttons"},a.post_content?wp.element.createElement("a",{className:l?"button is-primary is-loading":"button is-primary",onClick:function(){c(!0),fetch("".concat(window.helpdesk.api.url,"/bbp/user-info/create?post"),{method:"post",body:JSON.stringify(mn({},t,{post_content:a.post_content,raw:a.raw,token:yn("vibebp").getToken()}))}).then(function(e){return e.json()}).then(function(e){c(!1),e.status,e.hasOwnProperty("message")&&gn("vibebp").addNotification({text:e.message})})}},window.helpdesk.translations.submit):""))))};function En(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var On=wp.element,kn=(On.createElement,On.useState),Nn=wp.data.select,jn=function(){var e=Nn("vibebp").getUser(),t=En(kn({isAgent:window.helpdesk.settings.agents_cap&&e.roles.includes(window.helpdesk.settings.agents_cap),isSupervisor:window.helpdesk.settings.supervisor_cap&&e.roles.includes(window.helpdesk.settings.supervisor_cap)}),2);return[t[0],t[1]]};function Pn(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Sn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function An(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var In=wp.element,xn=(In.createElement,In.useState),Tn=In.useEffect,Dn=wp.data,Jn=Dn.dispatch,Ln=Dn.select,Un=function(e){var t=An(xn({}),2),n=t[0],r=t[1],a=An(xn([]),2),o=a[0],i=a[1],l=An(xn(!1),2),c=l[0],s=l[1],p=An(xn(""),2),u=p[0],m=p[1],d=An(xn(""),2),f=d[0],w=d[1],v=An(xn([]),2),b=v[0],h=(v[1],An(jn(),2)),g=h[0],y=(h[1],An(xn([]),2)),_=y[0],E=y[1];return Tn(function(){var e=Ln("vibebp").getMenu().filter(function(e){return"forums"===e.parent&&e.css_id&&"engagements"!=e.css_id});g.isAgent&&e.push({name:window.helpdesk.settings.canned_responses.label,slug:window.helpdesk.settings.canned_responses.slug,parent_slug:window.helpdesk.settings.canned_responses.parent_slug,css_id:window.helpdesk.settings.canned_responses.id,class:["menu-child"],parent:window.helpdesk.settings.canned_responses.parent_slug,icon:"vicon vicon-ticket"}),g.isSupervisor&&e.push({name:window.helpdesk.settings.assign_tickets.label,slug:window.helpdesk.settings.assign_tickets.slug,parent_slug:window.helpdesk.settings.assign_tickets.parent_slug,css_id:window.helpdesk.settings.assign_tickets.id,class:["menu-child"],parent:window.helpdesk.settings.assign_tickets.parent_slug,icon:"vicon vicon-ticket"}),g.isAgent&&(e.push({name:window.helpdesk.settings.assigned_tickets.label,slug:window.helpdesk.settings.assigned_tickets.slug,parent_slug:window.helpdesk.settings.assigned_tickets.parent_slug,css_id:window.helpdesk.settings.assigned_tickets.id,class:["menu-child"],parent:window.helpdesk.settings.assigned_tickets.parent_slug,icon:"vicon vicon-ticket"}),e.push({name:window.helpdesk.settings.resolved_tickets.label,slug:window.helpdesk.settings.resolved_tickets.slug,parent_slug:window.helpdesk.settings.resolved_tickets.parent_slug,css_id:window.helpdesk.settings.resolved_tickets.id,class:["menu-child"],parent:window.helpdesk.settings.resolved_tickets.parent_slug,icon:"vicon vicon-ticket"})),e.push({name:window.helpdesk.settings.my_info.label,slug:window.helpdesk.settings.my_info.slug,parent_slug:window.helpdesk.settings.my_info.parent_slug,css_id:window.helpdesk.settings.my_info.id,class:["menu-child"],parent:window.helpdesk.settings.my_info.parent_slug,icon:"vicon vicon-ticket"}),i(e);var t=Ln("vibebp").getAction();t&&m(t),t?e.findIndex(function(e){return e.css_id==t})>-1&&e[e.findIndex(function(e){return e.css_id==t})].class.push("current-menu-item"):-1==e[0].class.indexOf("current-menu-item")&&e[0].class.push("current-menu-item"),-1==document.querySelector("body").classList.value.indexOf("withsidebar")&&document.querySelector("body").classList.add("withsidebar"),i(e)},[]),Tn(function(){fetch("".concat(window.helpdesk.api.url,"/bbp/taxonomy"),{method:"post",body:JSON.stringify({taxonomy:window.helpdesk.settings.topic_priority_tax,token:Ln("vibebp").getToken()})}).then(function(e){return e.json()}).then(function(e){e.status&&E(e.data),e.hasOwnProperty("message")&&Jn("vibebp").addNotification({text:e.message})})},[]),wp.element.createElement("div",{className:"vibebp_sidebars"},wp.element.createElement("div",{className:"vibebp_left_sidebar_wrapper"},wp.element.createElement("div",{className:"vibebp_left_sidebar"},wp.element.createElement("h3",null,window.helpdesk.label),wp.element.createElement("a",{className:"button is-primary new_mail",onClick:function(){s(!0)}},window.helpdesk.translations.new_topic),wp.element.createElement("a",{className:"button is-link new_mail",onClick:function(){m("forums")}},window.helpdesk.translations.all_forums),o.map(function(e,t){var a=e.class.join(" ")+" "+e.css_id;return wp.element.createElement("a",{className:a,onClick:function(a){var l=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sn(n,!0).forEach(function(t){Cn(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sn(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},n);l.filter=e.css_id,l.paged=1,n.css_id!==l.filter&&r(l),m(e.css_id),Jn("vibebp").setAction(e.css_id);var c=Pn(o),s=c.findIndex(function(e){return e.class.indexOf("current-menu-item")>-1});c[s].class.splice(c[s].class.indexOf("current-menu-item"),1),c[t].class.push("current-menu-item"),i(c)}},e.name)}),b.length?wp.element.createElement("div",{className:"labels"},wp.element.createElement("div",{class:"labels_title"},wp.element.createElement("span",null,window.helpdesk.translations.labels)),wp.element.createElement("ul",{className:"topic_labels"},b.map(function(e,t){var n="";return f&&f==e.label&&(n="active"),wp.element.createElement("li",{className:n},wp.element.createElement("span",{onClick:function(){w("active"==n?"":e.label)},style:"active"==n?{borderColor:e.color}:{}},e.label,wp.element.createElement("span",{className:"topic_label_color",style:{background:e.color}})))}))):"")),wp.element.createElement("div",{className:"vibebp_main"},wp.element.createElement(V.Provider,{value:{priorities:_,activeTab:u}},c?wp.element.createElement(ae,{back:function(e){"created"==e&&m(e),s(!1)}}):"forums"===u?wp.element.createElement(Ot,{label:f}):"replies"===u?wp.element.createElement(Jt,{type:"mine",label:f}):"assign"===u?wp.element.createElement(Ft,{can_assign:!0}):"my_info"===u?wp.element.createElement(_n,null):"canned"===u?wp.element.createElement(pn,null):u?wp.element.createElement(pt,{type:u,label:f}):wp.element.createElement(pt,{type:"topics"}))))};function Rn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rn(n,!0).forEach(function(t){Hn(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rn(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Hn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Fn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var qn=wp.element,Bn=(qn.createElement,qn.useState),Vn=qn.useEffect,Zn=qn.useRef,zn=wp.data,Gn=zn.dispatch,Kn=zn.select,Qn=null,Wn=function(e){var t=Fn(jn(),2),n=t[0],r=(t[1],Fn(Bn({role:"student"}),2)),a=r[0],o=r[1],i=Fn(Bn({getting:!1}),2),l=i[0],c=i[1],s=Fn(Bn(null),2),p=s[0],u=s[1],m=Zn(),d=Fn(Bn(),2),f=(d[0],d[1]);return Vn(function(){p&&p.abort();var e=new AbortController,t=p?{signal:e.signal}:{};u(e),a.role&&(c(Mn({},l,{getting:!0})),fetch("".concat(window.helpdesk.api.url,"/bbp/dashboard-widget/stats"),Mn({method:"post"},t,{body:JSON.stringify(Mn({},a,{token:Kn("vibebp").getToken()}))})).then(function(e){return e.json()}).then(function(e){if(c(Mn({},l,{getting:!1})),e.status&&e.data){var t=Mn({},e.data);if(f(e.data),Chart){null!=Qn&&Qn.destroy();var n=m.current.getContext("2d"),r={type:"pie",data:{labels:[window.helpdesk.translations.resolved_topics,window.helpdesk.translations.unresolved_topics],datasets:[{label:window.helpdesk.translations.helpdesk_stats,data:[t.resolved,t.total-t.resolved],backgroundColor:["rgb(54, 162, 235)","rgb(255, 99, 132)"],hoverOffset:4}]}};Qn=new Chart(n,r)}}e.hasOwnProperty("message")&&Gn("vibebp").addNotification({text:e.message})}).catch(function(e){console.log(e),c(Mn({},l,{saving:!1}))}))},[a.role]),wp.element.createElement("div",{className:"helpdesk_dashboard_widget helpdesk_stats_wrapper vibebp_fomr"},wp.element.createElement("div",{className:"form_action"},n.isAgent||n.isSupervisor?wp.element.createElement("select",{value:a.role,onChange:function(e){return o(Mn({},a,{role:e.target.value}))}},wp.element.createElement("option",{value:""},window.helpdesk.translations.selectas),Object.keys(window.helpdesk.settings.user_roles).map(function(e){return"agent"===e&&!n.isAgent||"supervisor"===e&&!n.isSupervisor?"":wp.element.createElement("option",{value:e},window.helpdesk.settings.user_roles[e])})):""),wp.element.createElement("canvas",{style:{display:l.getting?"none":"block"},ref:m}),l.getting?wp.element.createElement("div",{class:"loading-roller"},wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null)):"")};function Xn(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Yn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function $n(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yn(n,!0).forEach(function(t){er(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yn(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function er(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var nr=wp.element,rr=(nr.createElement,nr.useState),ar=nr.useEffect,or=nr.useRef,ir=wp.data,lr=ir.dispatch,cr=ir.select,sr={responsive:!0,scales:{yAxes:[{ticks:{beginAtZero:!0}}]},plugins:{legend:{position:"top"},title:{display:!0,text:"Chart.js Bar Chart"}}},pr=window.helpdesk.settings.months,ur=function(e){var t=tr(jn(),2),n=t[0],r=(t[1],tr(rr({role:"student",start:(new Date).getTime()-6048e5,end:(new Date).getTime(),view:"yearly"}),2)),a=r[0],o=r[1],i=tr(rr({getting:!1}),2),l=i[0],c=i[1],s=tr(rr(null),2),p=s[0],u=s[1],m=tr(rr(),2),d=m[0],f=m[1];ar(function(){p&&p.abort();var e=new AbortController,t=p?{signal:e.signal}:{};if(u(e),a.role&&a.start&&a.end&&a.view&&a.start<=a.end){var n=$n({},a);if(("daily"===a.view||"weekly"===a.view)&&a.end-a.start>26784e5)return void lr("vibebp").addNotification({text:window.helpdesk.translations.select_max_one_month});c($n({},l,{getting:!0})),fetch("".concat(window.helpdesk.api.url,"/bbp/dashboard-widget/chart"),$n({method:"post"},t,{body:JSON.stringify($n({},n,{token:cr("vibebp").getToken()}))})).then(function(e){return e.json()}).then(function(e){if(c($n({},l,{getting:!1})),e.status&&e.data){var t=$n({},e.data),n=w(t),r={borderColor:"rgb(54, 162, 235)",backgroundColor:"rgb(54, 162, 235)"},a=Xn(t.total),o=Xn(t.resolved),i=a.map(function(e){return parseInt(e.count)}),s=a.map(function(e){if(t.resolved&&t.resolved.length){var n=o.findIndex(function(t){return t.key1===e.key1&&t.key2===e.key2});n>-1&&(e.count=parseInt(e.count)-parseInt(o[n].count))}return parseInt(e.count)}),p=a.map(function(e){if(o&&o.length){var t=o.findIndex(function(t){return t.key1===e.key1&&t.key2===e.key2});if(t>-1)return parseInt(o[t].count)}return 0}),u={type:"bar",data:{labels:n.total,datasets:[$n({label:window.helpdesk.translations.total_topics},r,{borderColor:window.helpdesk.settings.colors[0],backgroundColor:window.helpdesk.settings.colors[0],data:i}),$n({label:window.helpdesk.translations.resolved_topics},r,{borderColor:window.helpdesk.settings.colors[1],backgroundColor:window.helpdesk.settings.colors[1],data:p}),$n({label:window.helpdesk.translations.unresolved_topics},r,{borderColor:window.helpdesk.settings.colors[2],backgroundColor:window.helpdesk.settings.colors[2],data:s})]},options:sr};f(u)}e.hasOwnProperty("message")&&lr("vibebp").addNotification({text:e.message})}).catch(function(e){console.log(e),c($n({},l,{saving:!1}))})}},[a]);var w=function(e){var t={total:[]},n=Object.keys(t);return"daily"===a.view?n.map(function(n){e[n].forEach(function(e){t[n].push("".concat(e.key1," - ").concat(pr[e.key2-1]))})}):"weekly"===a.view?n.map(function(n){e[n].forEach(function(e){t[n].push("".concat(e.key1,"th week - ").concat(e.key2))})}):"yearly"===a.view&&n.map(function(n){e[n].forEach(function(e){t[n].push("".concat(pr[e.key1-1]," - ").concat(e.key2))})}),t};return wp.element.createElement("div",{className:"helpdesk_dashboard_widget helpdesk_chart_wrapper vibebp_fomr"},wp.element.createElement("div",{className:"form_action"},wp.element.createElement("div",null,n.isAgent||n.isSupervisor?wp.element.createElement("select",{value:a.role,onChange:function(e){return o($n({},a,{role:e.target.value}))}},wp.element.createElement("option",{value:""},window.helpdesk.translations.selectas),Object.keys(window.helpdesk.settings.user_roles).map(function(e){return"agent"===e&&!n.isAgent||"supervisor"===e&&!n.isSupervisor?"":wp.element.createElement("option",{value:e},window.helpdesk.settings.user_roles[e])})):""),wp.element.createElement("div",null,wp.element.createElement("div",{class:"buttons has-addons"},Object.keys(window.helpdesk.settings.chart_views).map(function(e){return wp.element.createElement("button",{className:a.view==e?"button is-success is-selected":"button",onClick:function(t){o($n({},a,{view:e}))}},window.helpdesk.settings.chart_views[e])}))),wp.element.createElement("div",{className:"select_time_difference"},wp.element.createElement("div",{className:"vibebp_form_field"},wp.element.createElement("label",null,window.helpdesk.translations.select_dates),wp.element.createElement("input",{type:"text",ref:function(e){e&&flatpickr(e,{altInput:!0,weekNumbers:!0,defaultDate:[a.start,a.end],mode:"range",onChange:function(e,t,n){if(2===e.length){var r=$n({},a);r.start=e[0].getTime(),r.end=e[1].getTime(),o(r)}}})}})))),wp.element.createElement(dr,{getting:l.getting,config:d}),l.getting?wp.element.createElement("div",{class:"loading-roller"},wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null),wp.element.createElement("div",null)):"")},mr=null,dr=function(e){var t=or();return ar(function(){if(Chart&&e.config){null!=mr&&mr.destroy();var n=t.current.getContext("2d");mr=new Chart(n,e.config)}},[e.config]),wp.element.createElement("canvas",{style:{display:e.getting?"none":"block"},ref:t})},fr=wp.element.render;document.addEventListener("component_loaded",function(e){"forums"===e.detail.component&&setTimeout(function(){fr(wp.element.createElement(Un,null),document.querySelector("#forums_component"))},200)},!1),document.addEventListener("vibe_helpdesk_stats",function(e){document.querySelectorAll(".wplms_dashboard_helpdesk_stats").forEach(function(e){fr(wp.element.createElement(Wn,null),e)})}),document.addEventListener("vibe_helpdesk_resolution_chart",function(e){document.querySelectorAll(".wplms_dashboard_helpdesk_chart").forEach(function(e){fr(wp.element.createElement(ur,null),e)})})}]);