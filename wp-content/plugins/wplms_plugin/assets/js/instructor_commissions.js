!function(t){var e={};function s(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,o){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(o,n,function(e){return t[e]}.bind(null,n));return o},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);s(1);const{createElement:o,render:n,useState:r,useEffect:a,Fragment:i,useRef:c}=wp.element,{select:l,dispatch:u}=wp.data,d=t=>{const e=c(null),s=c(null),[n,d]=r(!0),[m,p]=r({}),[_,w]=r(null),[b,h]=r(0),[f,v]=r(0),[g,y]=r([]),[k,O]=r(0),[N,S]=r(!1);a(()=>{S(!0),fetch(window.instructor_commissions.api+"/get_currencies",{method:"post",body:JSON.stringify({token:l("vibebp").getToken()})}).then(t=>t.ok?t.json():{status:0,message:window.wplms_course_data.translations.error_loading_data}).then(t=>{t.status&&t.hasOwnProperty("currencies")&&(y(t.currencies),w(t.currencies[0].value))}).catch(t=>{console.error("Uh oh, an error!",t),u("vibebp").addNotification({text:window.wplms_course_data.translations.error_loading_data})})},[]);const C=()=>{for(var t="#",e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t},j=(t=null)=>{t||(t=_),d(!0),fetch(`${window.instructor_commissions.api}/instructor_commissions?currency=${t}`,{method:"post",body:JSON.stringify({user_id:window.instructor_commissions.user_id,currency:t,token:l("vibebp").getToken()})}).then(t=>t.ok?t.json():{status:0,message:window.wplms_course_data.translations.error_loading_data}).then(t=>{t.status&&t.data&&p(t.data),d(!1)}).catch(t=>{d(!1),console.error("Uh oh, an error!",t),u("vibebp").addNotification({text:window.wplms_course_data.translations.error_loading_data})})};a(()=>{_&&j()},[_]),a(()=>{if(e&&e.current&&N&&!n&&m.hasOwnProperty("commissions")&&Object.keys(m.commissions).length){let t=["January","February","March","April","May","June","July","August","Spetember","October","November","December"],s=[],n=[],r=[];Object.keys(m.commissions).map(t=>{n[parseInt(t-1)]=parseInt(m.commissions[t].sales),s[parseInt(t-1)]=parseInt(m.commissions[t].commission)});for(var o=0;o<=11;o++)null!==n[o]&&void 0!==n[o]||(n[o]=0),null!==s[o]&&void 0!==s[o]||(s[o]=0);let a=C(),i=C();r.push({label:window.instructor_commissions.translations.earnings,data:n,borderColor:a,backgroundColor:a,showLines:!0,fill:!1}),r.push({label:window.instructor_commissions.translations.payouts,data:s,borderColor:i,backgroundColor:i,showLines:!0,fill:!1});let c=e.current.getContext("2d");b&&b.destroy();let l={};setTimeout(()=>{l=new Chart(c,{type:"line",data:{labels:t,datasets:r,options:{scales:{yAxes:[{stacked:!0,ticks:{beginAtZero:!0}}]}}}}),h(l)},200)}if(s&&!n&&m.hasOwnProperty("sales_pie")&&m.sales_pie.length){let t=[],e=[],o=[];m.sales_pie.map(e=>{t.push(e.label)}),m.sales_pie.map(t=>{e.push(t.value),o.push(C())}),r&&r.destroy();var r={};r=new Chart(s.current.getContext("2d"),{type:"doughnut",data:{datasets:[{data:e,backgroundColor:o}],labels:t}}),v(r)}setTimeout(()=>{document.dispatchEvent(new CustomEvent("vibebp_widget_loaded",{detail:{props:t}}))},500)},[m,n,N]);return o("div",{className:"wplms_dashboard_instructor_commission text-center"},o("span",{className:"vicon vicon-reload",onClick:t=>{d(!0),fetch(window.instructor_commissions.api+"/instructor_commissions/generate?post",{method:"post",body:JSON.stringify({token:l("vibebp").getToken()})}).then(t=>t.ok?t.json():{status:0,message:window.wplms_course_data.translations.error_loading_data}).then(t=>{localforage.removeItem(`${window.instructor_commissions.api}/instructor_commissions?currency=${_}`).then(()=>{alert(window.instructor_commissions.translations.calculated_commissions),d(!1),j()})}).catch(t=>{d(!1),console.error("Uh oh, an error!",t),u("vibebp").addNotification({text:window.wplms_course_data.translations.error_loading_data})})}}),n?o("div",{class:"widget_loader"},o("div",null),o("div",null),o("div",null),o("div",null)):o(i,null,m.hasOwnProperty("currencies")?o("div",{className:"dash_tabs"},g.map(t=>o("div",{className:"dash_tab "+(t.value==_?"active":""),onClick:()=>{w(t.value)}},o("span",{dangerouslySetInnerHTML:{__html:t.label}})))):"",o("div",{className:"wplms_instructor_commission_data"},o("div",{className:"wplms_instructor_commission_graph"},m.hasOwnProperty("commissions")?o("canvas",{ref:e}):o("div",{className:"vbp_message"},window.instructor_commissions.translations.no_data)),o("div",{className:"wplms_instructor_commission_pie"},o("canvas",{ref:s})))))};document.addEventListener("wplms_instructor_commission_stats",t=>{document.querySelector(".wplms_instructor_commission_stats")&&n(o(d,{type:document.querySelector(".wplms_instructor_commission_stats").getAttribute("data-type"),settings:t.detail.widget.options}),document.querySelector(".wplms_instructor_commission_stats"))})},function(t,e,s){}]);