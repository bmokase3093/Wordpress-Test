!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(0);var r=wp.element;r.createElement,r.useRef,r.useEffect,r.Fragment,r.render;function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(r=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var a=wp.element,o=(a.createElement,a.useState),l=(a.useEffect,a.Fragment),s=(a.render,wp.data),c=(s.dispatch,s.select),u=function(e){var t=i(o(!1),2),n=t[0],r=(t[1],i(o(!1),2)),a=r[0],s=r[1],u=i(o(""),2),d=u[0],f=u[1],m=i(o(!1),2),p=m[0],b=m[1],y=i(o(!1),2),v=y[0],w=y[1],g=e.def;return p&&(g="..."),v&&(g=e.alt),wp.element.createElement(l,null,a?ReactDOM.createPortal(wp.element.createElement("div",{className:"react_portal_modal_wrapper"},wp.element.createElement("span",{onClick:function(){return s(!1)}}),wp.element.createElement("div",{className:"react_portal_modal_content"},wp.element.createElement("div",{className:"react_portal_modal_header"},wp.element.createElement("div",null),wp.element.createElement("span",{className:"vicon vicon-close",onClick:function(){return s(!1)}})),wp.element.createElement("div",{className:"react_portal_modal_body"},wp.element.createElement("div",{class:"vibebp_message_box_wrapper"},wp.element.createElement("div",{className:"messagebox"},wp.element.createElement("textarea",{value:d,placeholder:window.vibebpactions.translations.message_text,onChange:function(e){return f(e.target.value)}}),wp.element.createElement("div",null,wp.element.createElement("a",{className:p?"button is-primary is-loading":"button is-primary",onClick:function(){b(!0);var t=new FormData;t.append("body",JSON.stringify({args:{content:d,recipients:[e.user_id],subject:window.vibebpactions.translations.message_subject,thread_id:0,meta:[]},token:c("vibebp").getToken()})),fetch("".concat(window.vibebpactions.api_url,"/messages/send?upload"),{method:"post",body:t}).then((function(e){return e.json()})).then((function(e){b(!1),w(!0),setTimeout((function(){s(!1)}),2e3)}))},dangerouslySetInnerHTML:{__html:g}}),wp.element.createElement("a",{className:"link",onClick:function(){return s(!1)}},window.vibebpactions.translations.cancel))))))),document.body):c("vibebp").getUser().id!=e.user_id?wp.element.createElement("span",{className:n?"button is-primary is-loading":"button is-primary",dangerouslySetInnerHTML:{__html:e.def},onClick:function(){return s(!0)}}):"")};function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(r=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var f=wp.element,m=(f.createElement,f.useState),p=f.useEffect,b=f.Fragment,y=(f.render,wp.data),v=y.dispatch,w=y.select,g=function(e){var t=d(m(!1),2),n=t[0],r=t[1],i=d(m(!1),2),a=i[0],o=i[1];p((function(){var t=w("vibebp").getData("friends");void 0!==t&&Array.isArray(t)?Array.isArray(t)&&t.indexOf(parseInt(e.user_id))>-1&&o(!0):(console.log("fetch it"),fetch("".concat(window.vibebpactions.api_url,"/friend_ids?force"),{method:"post",body:JSON.stringify({token:e.token})}).then((function(e){return e.json()})).then((function(n){n.status&&(t=n.friends,v("vibebp").setData("friends",n.friends),t.indexOf(e.user_id)>-1&&o(!0))})))}),[]);return wp.element.createElement(b,null,a?wp.element.createElement("span",{className:n?"button is-primary is-loading":"button is-primary",onClick:function(){r(!0),fetch("".concat(window.vibebpactions.api_url,"/friends/removefriendship?post"),{method:"post",body:JSON.stringify({friend_userid:e.user_id,token:e.token})}).then((function(e){return e.json()})).then((function(e){r(!1),o(!1)})),setFriends(nfriends)},dangerouslySetInnerHTML:{__html:e.alt}}):w("vibebp").getUser().id!=e.user_id?wp.element.createElement("span",{className:n?"button is-primary is-loading":"button is-primary",onClick:function(){r(!0),fetch("".concat(window.vibebp.api.url,"/friends/addfriendship?post"),{method:"post",body:JSON.stringify({friends:[e.user_id],token:e.token})}).then((function(e){return e.json()})).then((function(e){r(!1),o(!0)}))},dangerouslySetInnerHTML:{__html:e.def}}):"")};function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(r=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var h=wp.element,E=(h.createElement,h.useState),S=h.useEffect,O=h.Fragment,k=(h.render,wp.data),A=k.dispatch,j=k.select,N=function(e){var t=_(E(!1),2),n=t[0],r=t[1],i=_(E(!1),2),a=i[0],o=i[1];S((function(){var t=j("vibebp").getData("following");Array.isArray(t)&&t.indexOf(e.user_id)>-1&&o(!0)}),[]);var l=function(t){r(!0),fetch("".concat(window.vibebpactions.api_url,"/followers/action?post"),{method:"post",body:JSON.stringify({action:t,user:e.user_id,token:e.token})}).then((function(e){return e.json()})).then((function(n){if(r(!1),n.status){if("follow"===t){var i=j("vibebp").getData("following");i.push(e.user_id),A("vibebp").setData("following",i),o(!0),A("vibebp").addNotification({message:n.message}),A("vibebp").sendRealTimeNotification(n.rtm.user_id,n.rtm.message)}if("unfollow"===t){var a=j("vibebp").getData("following");a.splice(a.indexOf(e.user_id),1),A("vibebp").setData("following",a),o(!1),A("vibebp").addNotification({message:n.message}),A("vibebp").sendRealTimeNotification(n.rtm.user_id,n.rtm.message)}}}))};return wp.element.createElement(O,null,a?wp.element.createElement("span",{className:n?"button is-primary is-loading":"button is-primary",dangerouslySetInnerHTML:{__html:e.alt},onClick:function(){return l("unfollow")}}):j("vibebp").getUser().id!=e.user_id?wp.element.createElement("span",{className:n?"button is-primary is-loading":"button is-primary",dangerouslySetInnerHTML:{__html:e.def},onClick:function(){return l("follow")}}):"")};function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(r=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var L=wp.element,M=(L.createElement,L.useState),x=L.useEffect,I=L.Fragment,D=(L.render,wp.data),C=(D.dispatch,D.select),H=function(e){var t=T(M(!1),2),n=t[0],r=t[1];x((function(){var t=C("vibebp").getOnlineMembers();Array.isArray(t)&&t.indexOf(e.user_id)>-1&&r(!0),document.addEventListener("onlinemembers_loaded",(function(t){t.detail&&setTimeout((function(){var t=C("vibebp").getOnlineMembers();Array.isArray(t)&&t.indexOf(e.user_id)>-1&&r(!0)}),200)}))}),[]);return wp.element.createElement(I,null,C("vibebp").getUser().id!=e.user_id?n?wp.element.createElement("span",{onClick:function(){document.dispatchEvent(new CustomEvent("trigger_user_chat",{detail:{userId:e.user_id}}))},className:"button is-primary",dangerouslySetInnerHTML:{__html:e.def}}):wp.element.createElement("span",{className:"button is-primary",dangerouslySetInnerHTML:{__html:e.alt+" ("+window.vibebpactions.translations.offline+")"}}):"")},F=wp.element,P=(F.createElement,F.useState,F.useEffect),q=(F.Fragment,F.render,wp.data),J=(q.dispatch,q.select,function(e){return P((function(){})),wp.element.createElement("span",{className:"button is-primary",dangerouslySetInnerHTML:{__html:e.def}})}),R=wp.element,U=(R.createElement,R.useState,R.useEffect,R.Fragment,R.render),z=wp.data,B=z.dispatch,G=z.select;document.addEventListener("vibebp_all_members_loaded",K),document.addEventListener("DOMContentLoaded",K);var K=function(){localforage.getItem("bp_login_token").then((function(e){e?(document.querySelectorAll(".member_action").forEach((function(e){e.getAttribute("data-member"),e.querySelector("span").innerHTML})),Q(e)):document.querySelectorAll(".member_action").forEach((function(e){e.addEventListener("click",(function(){document.dispatchEvent(new Event("vibebp_show_login_popup"))}))}))}))};K();var Q=function(e){V(e).then((function(){W(e).then((function(){document.querySelectorAll(".member_action").forEach((function(t){var n=t.getAttribute("data-member"),r=t.querySelector("span").innerHTML,i="";t.querySelector("span.hide")&&(i=t.querySelector("span.hide").innerHTML),t.style.display="initial",t.classList.contains("send_message")&&U(wp.element.createElement(u,{user_id:n,token:e,def:r,alt:i}),t),t.classList.contains("friend")&&U(wp.element.createElement(g,{user_id:n,token:e,def:r,alt:i}),t),t.classList.contains("follow")&&U(wp.element.createElement(N,{user_id:n,token:e,def:r,alt:i}),t),t.classList.contains("chat")&&U(wp.element.createElement(H,{user_id:n,token:e,def:r,alt:i}),t),t.classList.contains("view_profile")&&U(wp.element.createElement(J,{user_id:n,def:r}),t)}))}))}))},V=function(e){return!window.vibebpactions.friends||G("vibebp")&&G("vibebp").getData("friends")?new Promise((function(e){e()})):fetch("".concat(window.vibebpactions.api_url,"/friend_ids?force"),{method:"post",body:JSON.stringify({token:e})}).then((function(e){return e.json()})).then((function(e){e.status&&(e.friends&&Array.isArray(e.friends)?B("vibebp").setData("friends",e.friends):B("vibebp").setData("friends",[]))}))},W=function(e){return!window.vibebpactions.followers||G("vibebp")&&G("vibebp").getData("following")?new Promise((function(e){e()})):fetch("".concat(window.vibebpactions.api_url,"/following_ids?force"),{method:"post",body:JSON.stringify({token:e})}).then((function(e){return e.json()})).then((function(e){e.status&&B("vibebp").setData("following",e.following)}))}}]);