!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var i=wp.data,r=i.dispatch,o=i.select,a=function(e){return new Promise((function(t){if(window.vibebp.settings.hasOwnProperty("firebase_config")&&window.vibebp.settings.firebase_config&&"undefined"!=typeof firebase&&firebase&&firebase.hasOwnProperty("database")&&firebase.database&&window.vibebp.settings.session_lock){var n=firebase.database().ref("users");n||t(),n.orderByChild("firebaseUid").equalTo(e).once("value",(function(i){if(i.exists()){var a=i.val();for(var s in a)a[s].hasOwnProperty("status")&&("loggedin_logout_all"==window.vibebp.settings.session_lock?function(){var i=o("vibebp").getData("loggedInNumber");i||(i=a[s].hasOwnProperty("loggedInNumber")?a[s].loggedInNumber+1:1,r("vibebp").setData("loggedInNumber",i),localforage.setItem("loggedInNumber",i)),firebase.database().ref("users/".concat(s,"/loggedInNumber")).set(i),firebase.database().ref("users/".concat(s,"/status")).onDisconnect().set(0),n.orderByChild("firebaseUid").equalTo(e).on("value",(function(e){if(e.exists()){var t=e.val();for(var n in t)t[n].hasOwnProperty("loggedInNumber")&&t[n].loggedInNumber&&t[n].loggedInNumber!==i&&document.dispatchEvent(new Event("vibebp_logout"))}})),t()}():a[s].hasOwnProperty("status")&&a[s].status&&t(window.vibebp.translations.online_from_other_account));t()}else t()})).catch((function(){t()}))}else t()}))};function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var u=wp.element,d=(u.createElement,u.useState),p=u.useEffect,b=u.Fragment,f=(u.render,wp.data),m=f.dispatch,g=(f.select,function(e){var t=c(d({}),2),n=t[0],i=t[1],r=c(d(null),2),o=r[0],l=r[1],u=c(d(!1),2),f=u[0],g=u[1];p((function(){window.vibebp.settings.firebase_config&&"object"==("undefined"==typeof firebase?"undefined":s(firebase))&&0===firebase.apps.length&&firebase.initializeApp(JSON.parse(window.vibebp.settings.firebase_config))}),[]),p((function(){if(window.vibebp.settings.firebase_config){var e={};Object.keys(window.vibebp.settings.auth).map((function(t){window.vibebp.settings.auth[t]&&("google"===t&&(e.google=new firebase.auth.GoogleAuthProvider,e.google.addScope("profile"),e.google.addScope("email")),"twitter"===t&&(e.twitter=new firebase.auth.TwitterAuthProvider),"github"===t&&(e.github=new firebase.auth.GithubAuthProvider),"apple"===t&&(e.apple=new firebase.auth.OAuthProvider("apple.com"),e.apple.addScope("email"),e.apple.addScope("name")),"facebook"===t&&(e.facebook=new firebase.auth.FacebookAuthProvider),"microsoft"===t&&(e.microsoft=new firebase.auth.OAuthProvider("microsoft.com")))})),i(e)}}),[]);var w=function(t,n){return fetch("".concat(window.vibebp.api.url,"/sociallogin?client_id=").concat(window.vibebp.settings.client_id,"&nocache"),{method:"post",body:JSON.stringify({social:t.credential.signInMethod,client_id:window.vibebp.settings.client_id,user:{email:t.user.email,uid:t.user.uid,name:t.user.displayName,avatar:t.user.photoURL,phoneNumber:t.user.phoneNumber,last_login:t.user.metadata.lastSignInTime,create_time:t.user.metadata.creationTime},idToken:n})}).then((function(e){return e.json()})).then((function(n){if(n.status)return localforage.setItem("bp_login_token",n.token),fetch("".concat(window.vibebp.api.validate_token,"?force&client_id=").concat(window.vibebp.settings.client_id),{method:"post",body:n.token}).then((function(e){return e.json()})).then((function(i){if(i.hasOwnProperty("data")){if("undefined"!=typeof firebase&&firebase&&firebase.hasOwnProperty("database")&&window.vibebp.settings.firebase_config&&firebase.database().ref("users/".concat(i.data.data.user.id,"/firebaseUid")).set(t.user.uid),localforage.setItem("bp_user",JSON.stringify(i.data.data.user)),sessionStorage.setItem("bp_user",JSON.stringify(i.data.data.user)),e.setUser(i.data.data.user),m("vibebp").setToken(n.token),console.log("#1"),m("vibebp").setUser(i.data.data.user),document.querySelector("body").classList.add("vibebp-logged-in"),window.vibebp.settings.login_redirect&&i.hasOwnProperty("redirect_component")&&i.redirect_component){var r="";r=i.redirect_component.split("http").length>1?i.redirect_component:i.redirect_component.split("#").length>1?window.vibebp.settings.login_redirect+i.data.data.user.slug+i.redirect_component:window.vibebp.settings.login_redirect+i.data.data.user.slug+"#"+i.redirect_component,window.location.href=r}var o=sessionStorage.getItem("loggedinmenu");return o?m("vibebp").setData("loggedinMenu",JSON.parse(o)):fetch("".concat(window.vibebp.api.url,"/loggedinmenu"),{method:"post",body:JSON.stringify({token:n.token})}).then((function(e){return e.json()})).then((function(e){e.status&&(sessionStorage.setItem("loggedinmenu",JSON.stringify(e.menu)),m("vibebp").setData("loggedinMenu",e.menu))})),i.data.data.user}}))}))};return wp.element.createElement(b,null,window.vibebp.settings.email_login?"":wp.element.createElement(b,null,wp.element.createElement("h2",{dangerouslySetInnerHTML:{__html:window.vibebp.translations.login_heading}}),wp.element.createElement("p",{dangerouslySetInnerHTML:{__html:window.vibebp.translations.login_message}})),o?wp.element.createElement("div",{className:"vbp_message error",dangerouslySetInnerHTML:{__html:o}}):"",window.vibebp.settings.firebase_config?Object.keys(window.vibebp.settings.auth).map((function(e){if(window.vibebp.settings.auth[e])return wp.element.createElement("a",{className:f==e?"button is-primary is-loading":"button is-primary",onClick:function(){return function(e){console.log("##0"),window.vibebp.settings.firebase_config&&n&&n[e]?(g(e),l(null),window.innerWidth<1024?firebase.auth().signInWithRedirect(n[e]).then((function(e){var t=e.user;a(t.user.uid).then((function(n){n&&n.length?l(n):(m("vibebp").setData("firebaseUser",t),t.getIdToken().then((function(t){w(e,t).then((function(e){m("vibebp").setUser(e)}))})))}))})).catch((function(e){console.log(e),"auth/account-exists-with-different-credential"===e.code&&(console.log("account exists in different login credentials"),firebase.auth().fetchSignInMethodsForEmail(e.email).then((function(t){if(g(!1),Array.isArray(t)){if(t.indexOf("google.com")>-1)(n=new firebase.auth.GoogleAuthProvider).addScope("profile"),n.addScope("email");else if(t.indexOf("facebook.com")>-1)var n=new firebase.auth.FacebookAuthProvider;else if(t.indexOf("twitter.com")>-1)n=new firebase.auth.TwitterAuthProvider;else if(t.indexOf("github.com")>-1)n=new firebase.auth.GithubAuthProvider;else if(t.indexOf("microsoft")>-1)n=new firebase.auth.OAuthProvider("microsoft.com");n.setCustomParameters({login_hint:e.email}),firebase.auth().signInWithRedirect(n).then((function(e){var t=e.user;a(t.uid).then((function(n){n&&n.length?l(n):t.getIdToken().then((function(t){w(e,t).then((function(e){m("vibebp").setUser(e)}))}))}))})).catch((function(e){console.log(e)}))}})))})):firebase.auth().signInWithPopup(n[e]).then((function(e){var t=e.user;a(t.uid).then((function(n){n&&n.length?l(n):(m("vibebp").setData("firebaseUser",t),t.getIdToken().then((function(t){w(e,t).then((function(e){m("vibebp").setUser(e)}))})))}))})).catch((function(e){console.log(e),"auth/account-exists-with-different-credential"===e.code&&(console.log("account exists in different login credentials"),firebase.auth().fetchSignInMethodsForEmail(e.email).then((function(t){if(g(!1),Array.isArray(t)){if(t.indexOf("google.com")>-1)(n=new firebase.auth.GoogleAuthProvider).addScope("profile"),n.addScope("email");else if(t.indexOf("facebook.com")>-1)var n=new firebase.auth.FacebookAuthProvider;else if(t.indexOf("twitter.com")>-1)n=new firebase.auth.TwitterAuthProvider;else if(t.indexOf("github.com")>-1)n=new firebase.auth.GithubAuthProvider;n.setCustomParameters({login_hint:e.email}),firebase.auth().signInWithPopup(n).then((function(e){var t=e.user;a(t.uid).then((function(n){n&&n.length?l(n):t.getIdToken().then((function(t){w(e,t).then((function(e){m("vibebp").setUser(e)}))}))}))})).catch((function(e){console.log(e)}))}})))}))):document.dispatchEvent(new CustomEvent("login_with_"+e,{detail:{key:e}}))}(e)}},window.vibebp.settings.icons&&window.vibebp.settings.icons[e]?wp.element.createElement("span",{className:"vicon",dangerouslySetInnerHTML:{__html:window.vibebp.settings.icons[e]}}):wp.element.createElement("span",{className:"icon vicon vicon-"+e}),wp.element.createElement("span",null,window.vibebp.translations[e]))})):"",window.vibebp.settings.email_login?"":wp.element.createElement("a",{className:"button is-primary",onClick:function(){return e.setemailSignIn(!0)}},wp.element.createElement("span",{className:"icon vicon vicon-email"}),wp.element.createElement("span",null,window.vibebp.translations.email_login)),wp.element.createElement("div",{className:"extra_details"},window.vibebp.settings.enable_registrations?isNaN(window.vibebp.settings.enable_registrations)?wp.element.createElement("p",null,window.vibebp.translations.no_account,wp.element.createElement("a",{className:"vibebp_forward_link",href:window.vibebp.settings.enable_registrations},window.vibebp.translations.create_one," ",wp.element.createElement("span",{className:"vicon vicon-arrow-right"}))):wp.element.createElement("p",null,window.vibebp.translations.no_account,wp.element.createElement("a",{className:"vibebp_forward_link",onClick:function(){return e.setRegistration(!0)}},window.vibebp.translations.create_one," ",wp.element.createElement("span",{className:"vicon vicon-arrow-right"}))):"",wp.element.createElement("p",null,window.vibebp.translations.login_terms)))});function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y={setUser:function(e){return document.dispatchEvent(new CustomEvent("userLoaded",{detail:{userLoaded:e}})),{type:"SET_USER",user:e}},addNotification:function(e){return{type:"ADD_NOTIFICATION",notification:v(v({},e),{},{id:(new Date).getTime()})}},removeNotification:function(e){return{type:"REMOVE_NOTIFICATION",notification:e}},updateNotification:function(e){return{type:"UPDATE_NOTIFICATION",notification:e}},getUser:function(){return{type:"GET_USER"}},verifyUser:function(e,t){return{type:"VERIFY_USER_API",path:e,token:t}},setToken:function(e){return{type:"SET_TOKEN",token:e}},logout:function(){var e=new CustomEvent("userLoaded",{detail:{userLoaded:!0,loggedOut:!0}});return document.dispatchEvent(e),localforage.removeItem("bp_login_token"),localforage.removeItem("loggedInNumber"),sessionStorage.removeItem("bp_user"),window.vibebp.settings.firebase_config&&firebase.auth().signOut(),document.querySelector("body").classList.add("vibebp_logout"),window.location.href=window.vibebp.settings.logout_redirect+"?vibebp_logout=1",{type:"LOGOUT"}},setMenu:function(e){return{type:"SET_MENU",menu:e}},setOnlineMembers:function(e){return{type:"SET_ONLINE_MEMBERS",onlineMembers:e}},setData:function(e,t){return{type:"SET_DATA",data_type:e,data:t}},setComponent:function(e){var t=window.location.href.split("#")[0]+"#",n=[],i=(window.location.href.replace(/[#&]+([^=&]+)=([^&]*)/gi,(function(e,t,i){n[t]=i})),""),r="",o="";return Object.keys(n).map((function(e){"component"!==e&&(i+="&"+e+"="+n[e]),"action"==e&&(r=n[e]),"id"==e&&(o=n[e])})),t+="component="+e,i.length&&(t+=i),window.location.href=t,localforage.removeItem("last_request"),document.querySelector("body").classList.forEach((function(e,t){e.indexOf("vibebp-component")>-1&&document.querySelector("body").classList.remove(e)})),document.querySelector("body").classList.add("vibebp-component-"+e),{type:"SET_COMPONENT",component:e,action:r,id:o}},setAction:function(e){var t=window.location.href.split("#")[0]+"#",n=[],i=(window.location.href.replace(/[#&]+([^=&]+)=([^&]*)/gi,(function(e,t,i){n[t]=i})),""),r="",o="";return Object.keys(n).map((function(e){"component"!==e&&"action"!==e&&(i+="&"+e+"="+n[e]),"component"==e&&(o=n[e]),"id"==e&&(r=n[e])})),o&&(t+="component="+o,e&&(t+="&action="+e,r&&(t+="&id="+r))),i.length&&(t+=i),window.location.href=t,{type:"SET_ACTION",action:e}},setId:function(e){var t=window.location.href.split("#")[0]+"#",n=[],i=(window.location.href.replace(/[#&]+([^=&]+)=([^&]*)/gi,(function(e,t,i){n[t]=i})),""),r="",o="";return Object.keys(n).map((function(e){"component"!==e&&"action"!==e&&"id"!=e&&(i+="&"+e+"="+n[e]),"action"==e&&(o=n[e]),"component"==e&&(r=n[e])})),r&&(t+="component="+r,o&&(t+="&action="+o,e&&(t+="&id="+e))),i.length&&(t+=i),window.location.href=t,{type:"SET_ID",id:e}},sendRealTimeNotification:function(e,t){return{type:"SEND_REALTIME_NOTIFICATION",user_id:e,message:t}},removeRealTimeNotification:function(e,t){return{type:"REMOVE_REALTIME_NOTIFICATION",user_id:e,message:t}},AddStaleRequest:function(e){var t=localforage.createInstance({name:"vibebp_stale_requests"}),n=Math.round((new Date).getTime()/1e3);return t.keys().then((function(i){var r=i.findIndex((function(t){return t.indexOf(e)>-1}));r>-1?t.setItem(i[r],n):t.setItem(e,n)})),{}}};function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e){return function(e){if(Array.isArray(e))return O(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){k(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var I=wp.data,T=I.registerStore,P=(I.combineReducers,I.useStore,{user:{},menu:[],notifications:[],component:"",action:""}),j=T("vibebp",{reducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER":return sessionStorage.setItem("bp_user",JSON.stringify(t.user)),N(N({},e),{},{user:t.user});case"ADD_NOTIFICATION":var n=E(e.notifications),i=[];return n.map((function(e,t){e.id>=(new Date).getTime()-3e3&&i.push(e)})),i.unshift(N({},t.notification)),N(N({},e),{},{notifications:i});case"REMOVE_NOTIFICATION":var r=E(e.notifications);return r.splice(r.findIndex((function(e){return t.notification.id===e.id})),1),N(N({},e),{},{notifications:r});case"UPDATE_NOTIFICATION":var o=E(e.notifications),a=o.findIndex((function(e){return t.notification.id===e.id}));return a>-1&&(o[a]=t.notification),N(N({},e),{},{notifications:o});case"GET_NOTIFICATIONS":return e.notifications;case"GET_USER":return e.user;case"SET_MENU":return N(N({},e),{},{menu:t.menu});case"GET_MENU":return e.menu;case"SET_TOKEN":return N(N({},e),{},{token:t.token});case"SET_COMPONENT":var s=new CustomEvent("component_loaded",{detail:{component:t.component,action:t.action,id:t.id,user:e.user,token:e.token}});return document.dispatchEvent(s),N(N({},e),{},{component:t.component,action:t.action,id:t.id});case"SET_ACTION":return N(N({},e),{},{action:t.action});case"SET_ID":return N(N({},e),{},{action:t.id});case"SET_ONLINE_MEMBERS":return N(N({},e),{},{onlineMembers:t.onlineMembers});case"SET_DATA":var c=N({},e.data);return c[t.data_type]=t.data,N(N({},e),{},{data:c});case"SEND_REALTIME_NOTIFICATION":var l=N({},e.user);return!e.hasOwnProperty("realTimeNotification")||e.realTimeNotification.message!=t.message&&e.realTimeNotification.user_id!=t.user_id?(window.vibebp.settings.firebase_config&&window.vibebp.settings.realtimenotifications&&firebase.database().ref("notifications/".concat(t.user_id)).push({time:(new Date).getTime(),sender:l.id,message:t.message}),N(N({},e),{},{realTimeNotification:{user_id:t.user_id,message:t.message}})):e}return e},actions:y,selectors:{getUser:function(e){return e.user},verifyUser:function(e,t,n){return e.user},setUser:function(e,t){return e.user=t,t},getNotifications:function(e){return e.notifications},removeNotification:function(e,t){var n=e.notifications;return n.splice(n.findIndex((function(e){return e.id===t})),1),e.notifications=n,n},updateNotification:function(e,t){var n=e.notifications;if("object"===_(t)){var i=n.findIndex((function(e){return e.id===t.id}));i>-1&&(n[i]=t),e.notifications=n}return n},logout:function(e){return e.user},setMenu:function(e,t){return e.menu},getMenu:function(e){return e.menu},getComponent:function(e){return e.component},getAction:function(e){return e.action},getId:function(e){return e.id},getToken:function(e){return e.token},setToken:function(e,t){return e.token=t,t},getOnlineMembers:function(e){return e.onlineMembers},getData:function(e,t){return!(!e.hasOwnProperty("data")||!e.data.hasOwnProperty(t))&&e.data[t]}},controls:{VERIFY_USER_API:function(e){var t=e.path,n=e.token;return fetch(t,{method:"post",body:n}).then((function(e){return e.json()})).then((function(e){if(e.hasOwnProperty("data"))return e.status?("undefined"!=typeof firebase&&firebase.hasOwnProperty("auth")&&firebase.auth().onAuthStateChanged((function(e){e&&Object.keys(e).length&&firebase.auth().currentUser&&a(e.uid).then((function(e){e&&e.length&&document.dispatchEvent(new Event("vibebp_logout"))}))})),localforage.setItem("bp_user",JSON.stringify(e.data.data.user)),e.data.data.user):(localforage.removeItem("bp_user"),localforage.removeItem("bp_login_token"),{})}))},LOGOUT:function(e){localforage.removeItem("bp_login_token"),localforage.removeItem("bp_user")}},resolvers:{verifyUser:regeneratorRuntime.mark((function e(t,n){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.verifyUser(t,n);case 2:return i=e.sent,e.abrupt("return",y.setUser(i));case 4:case"end":return e.stop()}}),e)})),setToken:regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.setToken(t));case 1:case"end":return e.stop()}}),e)})),setUser:regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.setUser(t));case 1:case"end":return e.stop()}}),e)})),addNotification:regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.addNotification(t));case 1:case"end":return e.stop()}}),e)})),removeNotification:regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.removeNotification(t));case 1:case"end":return e.stop()}}),e)})),updateNotification:regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.updateNotification(t));case 1:case"end":return e.stop()}}),e)})),logout:regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.logout();case 2:return e.sent,e.abrupt("return",y.setUser({}));case 4:case"end":return e.stop()}}),e)})),setMenu:regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.setMenu(t));case 1:case"end":return e.stop()}}),e)}))}});function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var U=wp.element,C=(U.createElement,U.useState),L=U.useEffect,M=U.Fragment,D=(U.render,wp.data),R=D.select,q=D.dispatch,J=function(e){var t=A(C(""),2),n=t[0],i=t[1],r=A(C(!1),2),o=r[0],s=r[1],c=A(C("input"),2),l=c[0],u=c[1],d=A(C("input"),2),p=(d[0],d[1]),b=A(C(""),2),f=b[0],m=b[1],g=A(C(!1),2),w=g[0],v=g[1],h=A(C(""),2),y=h[0],_=h[1],E=A(C(""),2),O=E[0],S=E[1],N=A(C(""),2),k=(N[0],N[1],A(C(!1),2)),I=k[0],T=k[1],P=A(C(!0),2),j=P[0],x=P[1];L((function(){window.vibebp.translations.login_checkbox.length&&x(!1)}),[]);var U=function(){var t=0;n.indexOf("@")>-1&&!n.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i)&&(u("input is-danger"),_(window.vibebp.translations.invalid_email),t++),f.length<4&&(p("input is-danger"),_(window.vibebp.translations.password_too_short),t++),!t&&j&&(s(!0),window.vibebp.settings.hasOwnProperty("firebase_config")&&window.vibebp.settings.firebase_config&&"undefined"!=typeof firebase&&firebase&&firebase.hasOwnProperty("database")&&firebase.database&&window.vibebp.settings.session_lock?fetch("".concat(window.vibebp.api.generate_token,"?nocache&client_id=").concat(window.vibebp.settings.client_id),{method:"post",body:JSON.stringify({email:n,password:f})}).then((function(e){return e.json()})).then((function(t){t.status?fetch("".concat(window.vibebp.api.validate_token,"?client_id=").concat(window.vibebp.settings.client_id,"&nocache"),{method:"post",body:t.token}).then((function(e){return e.json()})).then((function(n){n.hasOwnProperty("data")&&firebase.auth().signInWithEmailAndPassword(n.data.data.user.email,n.data.data.user.refresh_token).then((function(i){a(i.user.uid).then((function(r){if(r&&r.length)_(r);else{if(s(!1),localforage.setItem("bp_login_token",t.token),R("vibebp").setToken(t.token),localforage.setItem("bp_user",n.data.data.user),sessionStorage.setItem("bp_user",JSON.stringify(n.data.data.user)),e.setUser(n.data.data.user),q("vibebp").setData("firebaseUser",i),n.data.data.user.firebaseUid=i.user.uid,D(n.data.data.user),q("vibebp").setUser(n.data.data.user),document.querySelector("body").classList.contains("logged-out")&&document.querySelector("body").classList.remove("logged-out"),document.querySelector("body").classList.contains("logged-in")||document.querySelector("body").classList.add("logged-in"),window.vibebp.settings.login_redirect&&n.hasOwnProperty("redirect_component")&&n.redirect_component){var o="";o=n.redirect_component.split("http").length>1?n.redirect_component:n.redirect_component.split("#").length>1?window.vibebp.settings.login_redirect+n.data.data.user.slug+n.redirect_component:window.vibebp.settings.login_redirect+n.data.data.user.slug+"#"+n.redirect_component,window.location.href=o}fetch("".concat(window.vibebp.api.url,"/loggedinmenu"),{method:"post",body:JSON.stringify({token:t.token})}).then((function(e){return e.json()})).then((function(e){e.status&&(q("vibebp").setUser(n.data.data.user),q("vibebp").setData("loggedinMenu",e.menu))}))}}))})).catch((function(i){400!=i.code&&"auth/user-not-found"!=i.code||(console.log("create user in firebase"),firebase.auth().createUserWithEmailAndPassword(n.data.data.user.email,n.data.data.user.refresh_token).then((function(i){if(s(!1),localforage.setItem("bp_login_token",t.token),R("vibebp").setToken(t.token),localforage.setItem("bp_user",n.data.data.user),sessionStorage.setItem("bp_user",JSON.stringify(n.data.data.user)),e.setUser(n.data.data.user),q("vibebp").setData("firebaseUser",i),n.data.data.user.firebaseUid=i.user.uid,D(n.data.data.user),q("vibebp").setUser(n.data.data.user),document.querySelector("body").classList.contains("logged-out")&&document.querySelector("body").classList.remove("logged-out"),document.querySelector("body").classList.contains("logged-in")||document.querySelector("body").classList.add("logged-in"),window.vibebp.settings.login_redirect&&n.hasOwnProperty("redirect_component")&&n.redirect_component){var r="";r=n.redirect_component.split("http").length>1?n.redirect_component:n.redirect_component.split("#").length>1?window.vibebp.settings.login_redirect+n.data.data.user.slug+n.redirect_component:window.vibebp.settings.login_redirect+n.data.data.user.slug+"#"+n.redirect_component,window.location.href=r}fetch("".concat(window.vibebp.api.url,"/loggedinmenu"),{method:"post",body:JSON.stringify({token:t.token})}).then((function(e){return e.json()})).then((function(e){e.status&&q("vibebp").setData("loggedinMenu",e.menu)}))})).catch((function(e){console.log("register",e)})))}))})):_(t.message)})):fetch("".concat(window.vibebp.api.generate_token,"?client_id=").concat(window.vibebp.settings.client_id,"&nocache"),{method:"post",body:JSON.stringify({email:n,password:f})}).then((function(e){return e.json()})).then((function(t){s(!1),t.status?(localforage.setItem("bp_login_token",t.token),R("vibebp").setToken(t.token),fetch("".concat(window.vibebp.api.validate_token,"?nocache&client_id=").concat(window.vibebp.settings.client_id),{method:"post",body:t.token}).then((function(e){return e.json()})).then((function(n){if(n.hasOwnProperty("data")){if(localforage.setItem("bp_user",n.data.data.user),sessionStorage.setItem("bp_user",JSON.stringify(n.data.data.user)),e.setUser(n.data.data.user),window.vibebp.settings.firebase_config&&"function"==typeof firebase.database&&!firebase.auth().currentUser?firebase.auth().signInWithEmailAndPassword(n.data.data.user.email,n.data.data.user.refresh_token).then((function(e){q("vibebp").setData("firebaseUser",e),n.data.data.user.firebaseUid=e.user.uid,D(n.data.data.user),q("vibebp").setUser(n.data.data.user)})).catch((function(e){console.log(e),400!=e.code&&"auth/user-not-found"!=e.code||firebase.auth().createUserWithEmailAndPassword(n.data.data.user.email,n.data.data.user.refresh_token).then((function(e){q("vibebp").setData("firebaseUser",e),n.data.data.user.firebaseUid=e.user.uid,D(n.data.data.user),q("vibebp").setUser(n.data.data.user)})).catch((function(e){console.log("register",e)}))})):q("vibebp").setUser(n.data.data.user),document.querySelector("body").classList.contains("logged-out")&&document.querySelector("body").classList.remove("logged-out"),document.querySelector("body").classList.contains("logged-in")||document.querySelector("body").classList.add("logged-in"),window.vibebp.settings.login_redirect&&n.hasOwnProperty("redirect_component")&&n.redirect_component){var i="";i=n.redirect_component.split("http").length>1?n.redirect_component:n.redirect_component.split("#").length>1?window.vibebp.settings.login_redirect+n.data.data.user.slug+n.redirect_component:window.vibebp.settings.login_redirect+n.data.data.user.slug+"#"+n.redirect_component,window.location.href=i}fetch("".concat(window.vibebp.api.url,"/loggedinmenu"),{method:"post",body:JSON.stringify({token:t.token})}).then((function(e){return e.json()})).then((function(e){e.status&&q("vibebp").setData("loggedinMenu",e.menu)}))}}))):_(t.message)})))},D=function(e){firebase.database().ref("users/".concat(e.id,"/status")).set(1),firebase.database().ref("users/".concat(e.id,"/firebaseUid")).set(e.firebaseUid);var t=document.createElement("div");t.classList.add("vibebp_live_modules"),document.body.appendChild(t)};return wp.element.createElement(M,null,wp.element.createElement("h2",null,w?window.vibebp.translations.forgotpassword:window.vibebp.translations.signin_email_heading),wp.element.createElement("p",null,window.vibebp.translations.signin_email_description),wp.element.createElement("div",{className:"loginform"},O.length?wp.element.createElement("div",{className:"message"},wp.element.createElement("div",{dangerouslySetInnerHTML:{__html:O}})):wp.element.createElement("div",{className:"field"},wp.element.createElement("div",{className:"control"},wp.element.createElement("label",null,wp.element.createElement("strong",null,window.vibebp.translations.email)),wp.element.createElement("input",{className:l,type:"text",onChange:function(e){i(e.target.value)}}))),w?O.length?"":wp.element.createElement(M,null,wp.element.createElement("a",{className:I?"button is-primary is-loading":"button is-primary",onClick:function(){T(!0),fetch("".concat(window.vibebp.api.url,"/forgotPassword?nocache&client_id=").concat(window.vibebp.settings.client_id),{method:"post",body:JSON.stringify({email:n})}).then((function(e){return e.json()})).then((function(e){T(!1),e.hasOwnProperty("message")&&(q("vibebp").addNotification({text:e.message}),S(e.message),setTimeout((function(){S("")}),5e3))}))}},window.vibebp.translations.password_recovery_email)):wp.element.createElement(M,null,wp.element.createElement("div",{className:"field"},wp.element.createElement("div",{className:"control"},wp.element.createElement("label",null,wp.element.createElement("strong",null,window.vibebp.translations.password),wp.element.createElement("span",{className:"forgot_password",onClick:function(){return v(!0)}},window.vibebp.translations.forgotpassword)),wp.element.createElement("input",{className:"input",type:"password",onChange:function(e){m(e.target.value),_("")},onKeyPress:function(e){"Enter"===e.key&&U()}}))),window.vibebp.translations.login_checkbox.length?wp.element.createElement("div",{className:j?"checkbox":"checkbox error"},wp.element.createElement("input",{id:"login_checkbox",type:"checkbox",onClick:function(){return x(!j)}}),wp.element.createElement("label",{for:"login_checkbox",dangerouslySetInnerHTML:{__html:window.vibebp.translations.login_checkbox}})):"",wp.element.createElement("a",{className:o?"button is-primary is-loading":"button is-primary",onClick:U},o&&R("vibebp").getToken()?"...":window.vibebp.translations.signin),y.length?wp.element.createElement("div",{className:"error"},y):"")),window.vibebp.settings.email_login?w?wp.element.createElement("div",{class:"extra_details"},wp.element.createElement("a",{className:"vibebp_back_link",onClick:function(){v(!1)}},wp.element.createElement("span",{className:"vicon vicon-arrow-left"}),window.vibebp.translations.back_to_signin)):"":wp.element.createElement("div",{class:"extra_details"},wp.element.createElement("a",{className:"vibebp_back_link",onClick:function(){e.setemailSignIn(!1),v(!0)}},wp.element.createElement("span",{className:"vicon vicon-arrow-left"}),window.vibebp.translations.all_signin_options)))};function F(e){return function(e){if(Array.isArray(e))return W(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||G(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t)||G(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(e,t){if(e){if("string"==typeof e)return W(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?W(e,t):void 0}}function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var $=wp.element,z=($.createElement,$.useState),B=$.useEffect,V=$.Fragment,K=($.render,wp.data),Y=(K.dispatch,K.select,function(e){var t=H(z(window.vibebp.settings.registration_fields),2),n=t[0],i=t[1],r=H(z(!1),2),o=r[0],a=r[1],s=H(z(!1),2),c=s[0],l=s[1],u=H(z(""),2),d=u[0],p=u[1],b=H(z(!0),2),f=b[0],m=b[1],g=H(z(!1),2),w=g[0],v=g[1],h=H(z(!1),2),y=h[0],_=h[1];B((function(){window.vibebp.translations.registration_checkbox.length&&m(!1)}),[]);var E=function(e,t){var r=F(n);if(r[t].value=e.target.value,window.vibebp.settings.hasOwnProperty("strong_password")&&window.vibebp.settings.strong_password){var o=function(e){if(!e.length)return!1;var t=[];return e.length<window.vibebp.settings.password_length&&t.push(window.vibebp.translations.password_6_chars),e.search(/[a-z]/i)<0&&t.push(window.vibebp.translations.password_one_letter),e.search(/[0-9]/)<0&&t.push(window.vibebp.translations.password_digit),e.search(/[A-Z]/)<0&&t.push(window.vibebp.translations.password_uppercase),e.search(/[!@#$%^&*]/)<0&&t.push(window.vibebp.translations.special_char),!(t.length>0)||t}(r[t].value);!0!==o?r[t].value.length&&(r[t].class=e.target.className+" is-danger",v(o),window.vibebp.settings.hasOwnProperty("password_strength_colors")&&window.vibebp.settings.password_strength_colors&&vibebp.settings.password_strength_colors.length&&_(vibebp.settings.password_strength_colors[o.length])):(r[t].class=r[t].class.split("is-danger").join(" "),v(!1),r[t].value.length&&window.vibebp.settings.hasOwnProperty("password_strength_colors")&&window.vibebp.settings.password_strength_colors&&vibebp.settings.password_strength_colors.length&&_(vibebp.settings.password_strength_colors[0])),r[t].value.length||(_(!1),v(!1))}i(r)};return wp.element.createElement(V,null,wp.element.createElement("h2",null,window.vibebp.translations.register_account_heading),wp.element.createElement("p",null,window.vibebp.translations.register_account_description),wp.element.createElement("div",{className:"loginform"},d.length?wp.element.createElement("div",{className:"registration_message",dangerouslySetInnerHTML:{__html:d}}):n.length?wp.element.createElement(V,null,n.map((function(e,t){return wp.element.createElement("div",{className:"field"},wp.element.createElement("div",{className:"control"},wp.element.createElement("label",null,wp.element.createElement("strong",null,e.label),"password"==e.type&&window.vibebp.settings.hasOwnProperty("strong_password")&&window.vibebp.settings.strong_password&&e.value.length?wp.element.createElement("span",{style:{color:y&&y.length?y:"var(--text)"},className:e.value.length&&!w?"passwordindiIcon vicon vicon-check-box":"passwordindiIcon vicon vicon-info-alt"}):"","password"==e.type&&window.vibebp.settings.hasOwnProperty("strong_password")&&window.vibebp.settings.strong_password&&e.value.length&&w&&w.length?wp.element.createElement("span",{className:"passworderrorwrapper"},w.map((function(e){return wp.element.createElement("strong",{className:"error"},e)}))):""),"email"==e.type?wp.element.createElement("input",{className:e.class,type:"text",value:e.value,onChange:function(e){var r=F(n);r[t].value=e.target.value,n.map((function(e,t){"email"!=e.type||r[t].value.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i)||-1!=r[t].class.indexOf("is-danger")?r[t].class=r[t].class.split("is-danger").join(" "):r[t].class+=" is-danger"})),i(r)}}):"password"==e.type?wp.element.createElement("div",{className:"passwordfield"},wp.element.createElement("input",{className:e.class,type:"password",value:e.value,onChange:function(e){E(e,t)}})):"phone"==e.type||"mobile"==e.type?wp.element.createElement("input",{className:e.class,type:"telephone",value:e.value,onChange:function(e){var r=F(n);r[t].value=e.target.value,n.map((function(e,t){"phone"!=e.type&&"mobile"!=e.type||r[t].value.match(/^(\+\d{1,3}[- ]?)?\d{10}$/)||r[t].value.match(/0{5,}/)||-1!=r[t].class.indexOf("is-danger")?r[t].class=r[t].class.split("is-danger").join(" "):r[t].class+=" is-danger"})),i(r)}}):wp.element.createElement("input",{className:e.class,type:"text",value:e.value,onChange:function(e){var r=F(n);r[t].value=e.target.value,i(r)}})))})),window.vibebp.translations.registration_checkbox.length?wp.element.createElement("div",{className:f?"checkbox":"checkbox error"},wp.element.createElement("input",{id:"registration_checkbox",type:"checkbox",onClick:function(){return m(!f)}}),wp.element.createElement("label",{for:"registration_checkbox",dangerouslySetInnerHTML:{__html:window.vibebp.translations.registration_checkbox}})):"",wp.element.createElement("a",{className:c?"button is-primary is-loading":"button is-primary",onClick:function(){window.vibebp.settings.hasOwnProperty("strong_password")&&window.vibebp.settings.strong_password&&w||f&&(l(!0),fetch("".concat(window.vibebp.api.url,"/registerUser?client_id=").concat(window.vibebp.settings.client_id),{method:"post",body:JSON.stringify(n)}).then((function(e){return e.json()})).then((function(e){l(!1),e.status?p(e.message):a(e.message)})))}},window.vibebp.translations.create_account),o?wp.element.createElement("div",{className:"error",dangerouslySetInnerHTML:{__html:o}}):""):""),wp.element.createElement("div",{className:"extra_details"},wp.element.createElement("p",null,window.vibebp.translations.account_already,wp.element.createElement("a",{className:"vibebp_forward_link",onClick:function(){return e.setRegistration(!1)}},window.vibebp.translations.signin," ",wp.element.createElement("span",{className:"vicon vicon-arrow-right"}))),wp.element.createElement("p",null,window.vibebp.translations.login_terms)))});function Z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Q(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var X=wp.element,ee=(X.createElement,X.useState),te=X.useEffect,ne=(X.Fragment,X.render,wp.data),ie=ne.dispatch,re=ne.select,oe=function(e){var t=Z(ee("user_menu"),2),n=t[0],i=t[1],r=Z(ee(""),2),o=(r[0],r[1],Z(ee(re("vibebp").getData("loggedinMenu")),2)),a=o[0],s=(o[1],Z(ee(!1),2)),c=(s[0],s[1],re("vibebp").getUser());te((function(){setTimeout((function(){i(n.replace(/active/g,"")+" active")}),30)}),[]);return wp.element.createElement("div",{className:n},wp.element.createElement("div",{className:"usermenu_content"},a.length?a.map((function(e){return wp.element.createElement("a",{href:c.profile_link+"#component="+e.css_id,className:e.classes.join(" "),onClick:function(t){t.preventDefault(),function(e){var t=re("vibebp").getUser();e.classes.indexOf("bp-menu")>-1?window.location===t.profile_link?ie("vibebp").setComponent(e.css_id):window.location=t.profile_link+"#component="+e.css_id:window.location.href=e.url}(e)},dangerouslySetInnerHTML:{__html:e.title}})})):wp.element.createElement("a",{href:c.profile_link},window.vibebp.translations.profile)),wp.element.createElement("a",{onClick:e.logout},wp.element.createElement("span",{className:"vicon vicon-power-off"}),window.vibebp.translations.logout))};function ae(e,t,n,i,r,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,r)}function se(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function a(e){ae(o,i,r,a,s,"next",e)}function s(e){ae(o,i,r,a,s,"throw",e)}a(void 0)}))}}var ce=wp.data,le=ce.dispatch,ue=(ce.select,0),de=function(e){var t=e.detail.userLoaded;if(!ue&&"undefined"!=typeof firebase&&firebase.hasOwnProperty("database")&&t&&void 0!==t.id){var n=firebase.database().ref("stale_requests/global"),i=firebase.database().ref("stale_requests/".concat(t.id)),r=localforage.createInstance({name:"vibebp_stale_requests",storeName:"user"}),o=localforage.createInstance({name:"vibebp_stale_requests",storeName:"global"}),a=localforage.createInstance({name:"vibebp_last_requests"});Math.round((new Date).getTime()/1e3);n.on("value",(function(e){e.exists()&&se(regeneratorRuntime.mark((function t(){var n,i,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.val(),[],t.next=4,a.keys();case 4:for(i in t.sent,n)r=decodeURIComponent(i),n[i].hasOwnProperty("time")?o.setItem(r,n[i].time):o.setItem(r,n[i]);case 6:case"end":return t.stop()}}),t)})))()})),i.on("value",(function(e){e.exists()&&se(regeneratorRuntime.mark((function t(){var n,o,s,c,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.val(),o=[],t.next=4,a.keys();case 4:for(l in s=t.sent,c=function(e){var t=decodeURIComponent(e);o.push(r.keys().then((function(i){var o=i.findIndex((function(e){return e.indexOf(t)>-1}));o>-1?n[e].hasOwnProperty("time")?r.setItem(i[o],n[e].time):r.setItem(i[o],n[e]):n[e].hasOwnProperty("time")?r.setItem(t,n[e].time):r.setItem(t,n[e])}))),s&&s.length&&s[s.length-1].indexOf(t)>-1&&localforage.getItem(s[s.length-1]).then((function(t){(t=JSON.parse(t))&&parseInt(t.vibebp_timestamp)<parseInt(n[e].time)&&le("vibebp").addNotification({icon:"vicon vicon-reload",position:"topCenter",text:window.vibebp.translations.load_new_data,actions:[{label:window.vibebp.translations.refresh,event:"reload_last_request",url:s[s.length-1]}]})}))},n)c(l);Promise.all(o).then((function(){i.remove()}));case 8:case"end":return t.stop()}}),t)})))()})),ue=1}};function pe(e){return function(e){if(Array.isArray(e))return he(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||ve(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){me(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ge(e){return(ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function we(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t)||ve(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ve(e,t){if(e){if("string"==typeof e)return he(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?he(e,t):void 0}}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var ye=wp.element,_e=(ye.createElement,ye.useState),Ee=ye.useEffect,Oe=ye.Fragment,Se=ye.render,Ne=wp.data,ke=Ne.dispatch,Ie=Ne.select,Te=1,Pe=function(e){var t=we(_e(!1),2),n=t[0],i=t[1],r=we(_e({}),2),o=r[0],s=r[1],c=we(_e(!0),2),l=c[0],u=c[1],d=we(_e(!1),2),p=d[0],b=d[1],f=we(_e(!1),2),m=f[0],w=f[1],v=we(_e(!1),2),h=(v[0],v[1],we(_e(!0),2)),y=h[0],_=h[1],E=we(_e(!1),2),O=E[0],S=E[1],N=we(_e(!1),2),k=N[0],I=N[1],T=we(_e("login_popup "+window.vibebp.style),2),P=T[0],A=T[1],x=we(_e(!1),2),U=x[0],C=x[1],L=we(_e([]),2),M=(L[0],L[1],we(_e(!1),2)),D=(M[0],M[1]),R=we(_e(!0),2),q=R[0],F=R[1],H=we(_e(!0),2),G=H[0],W=H[1],$=we(_e(!1),2),z=$[0],B=$[1];window.vibebp.settings.firebase_config&&(firebase.apps.length||firebase.initializeApp(JSON.parse(window.vibebp.settings.firebase_config))),Ee((function(){document.addEventListener("tokenGenerated",(function(){B(!z)})),window.vibebp.settings.email_login&&S(!0),localforage.getItem("bp_user").then((function(e){e&&("object"!==ge(e)?b(JSON.parse(e)):b(e))}));var e=setTimeout((function(){F(!1)}),5e3);return localforage.getItem("loggedInNumber").then((function(e){e&&ke("vibebp").setData("loggedInNumber",e)})),document.addEventListener("userLoaded",de,{once:!0,passive:!0}),document.addEventListener("reload_last_request",V,{once:!1,passive:!0}),function(){clearTimeout(e),document.removeEventListener("userLoaded",de),document.removeEventListener("reload_last_request",V)}}),[]),Ee((function(){new Promise((function(e){e(localforage.getItem("bp_login_token"))})).then((function(e){e?(Ie("vibebp").setToken(e),Ie("vibebp").verifyUser("".concat(window.vibebp.api.validate_token,"?client_id=").concat(window.vibebp.settings.client_id,"&force"),e),j.subscribe((function(){if(y){s(j.getState().user),Ie("vibebp").getUser()&&Object.keys(Ie("vibebp").getUser()).length&&document.dispatchEvent(new CustomEvent("userLoaded",{detail:{userLoaded:j.getState().user}}));var t=Ie("vibebp").getNotifications();t&&t.length?t.map((function(e,t){var n="var(--dark)",i="",r="var(--white)";if(e.hasOwnProperty("backgroundColor")&&e.backgroundColor)n=e.backgroundColor;else switch(e.type){case"error":n="var(--error)",i="vicon vicon-alert";break;case"success":n="var(--success)",i="vicon vicon-check";break;default:n="var(--dark)"}e.hasOwnProperty("textColor")&&e.textColor&&(r=e.textColor);var o="bottomRight";if(e.hasOwnProperty("position")&&e.position&&(o=e.position),!("object"!==ge(window.iziToast)||e.hasOwnProperty("read")&&e.read)){var a={title:void 0!==e.title?e.title:"",message:void 0!==e.text?e.text:"",icon:i,backgroundColor:n,titleColor:r,messageColor:r,iconColor:r,progressBarColor:"var(--primary)",rtl:window.vibebp.settings.is_rtl,position:o,onOpened:function(){}};e.iconUrl&&(a.iconUrl=e.iconUrl),e.icon&&(a.icon=e.icon),e.hasOwnProperty("actions")&&e.actions&&e.actions.length&&(a.buttons=[],e.actions.map((function(t){a.buttons.push(['<a className="link">'+t.label+"</a>",function(n,i){var r=new CustomEvent(t.event,{detail:fe(fe({},t),{},{item_id:e.item_id,user_id:Ie("vibebp").getUser().id})});document.dispatchEvent(r)}])}))),window.iziToast.show(a)}Z(e)})):D(!1),document.querySelector("body").classList.remove("logged-out"),document.querySelector("body").classList.add("logged-in"),_(!1),F(!1),!Ie("vibebp").getData("loggedinMenu")&&Te&&(Te=0,fetch("".concat(window.vibebp.api.url,"/loggedinmenu"),{method:"post",body:JSON.stringify({token:e})}).then((function(e){return e.json()})).then((function(e){u(!1),e.status&&ke("vibebp").setData("loggedinMenu",e.menu)})))}}))):(F(!1),u(!1))}))}),[z]),Ee((function(){var e=[];return window.vibebp.settings.firebase_config&&"function"==typeof firebase.database&&Object.keys(o).length&&(G&&firebase.auth()&&firebase.auth().currentUser&&(firebase.database().ref("users/".concat(o.id,"/status")).once("value").then((function(e){if(e.exists()){var t=e.val();firebase.database().ref("users/".concat(o.id,"/status")).set(t+1)}else firebase.database().ref("users/".concat(o.id,"/status")).set(1)})),firebase.database().ref("users/".concat(o.id,"/status")).onDisconnect().set(0),fetch("".concat(window.vibebp.api.url,"/followers"),{method:"post",body:JSON.stringify({token:Ie("vibebp").getToken()})}).then((function(e){return e.json()})).then((function(e){e.status&&e.followers.map((function(e){firebase.database().ref("users/".concat(e.ID,"/status")).once("value").then((function(t){t.exists()&&t.val()&&firebase.database().ref("notifications/".concat(e.ID)).push({sender:Ie("vibebp").getUser().id,type:"user_online",status:1,time:(new Date).getTime()})}))}))})),firebase.database().ref("notifications/".concat(j.getState().user.id)).on("child_added",(function(t){if(t.exists()){var n=t.val();n.hasOwnProperty("message")?ke("vibebp").addNotification({text:n.message}):fetch("".concat(window.vibebp.api.url,"/process_notification?nocache"),{method:"post",body:JSON.stringify(fe(fe({},n),{},{token:Ie("vibebp").getToken()}))}).then((function(e){return e.json()})).then((function(t){if(t.status){ke("vibebp").addNotification(t);var n=setTimeout((function(){firebase.database().ref("notifications/".concat(o.id,"/").concat(key,"/status")).set(0)}),1e4);e.push(n)}}))}})),W(!1)),window.addEventListener("online",(function(){ke("vibebp").addNotification({text:window.vibebp.translations.online})}),!1),window.addEventListener("offline",(function(){ke("vibebp").addNotification({text:window.vibebp.translations.offline})}),!1)),function(){e.length&&e.map((function(e){clearTimeout(e)}))}}),[o]),Ee((function(){j.getState().user&&s(j.getState().user)}),[j.getState().user]),Ee((function(){document.addEventListener("vibebp_show_login_popup",(function(){j.getState().user&&Object.keys(j.getState().user).length||(i(!0),setTimeout((function(){A(P+" active")}),30))})),window.innerWidth<1024&&"undefined"!=typeof firebase&&firebase.hasOwnProperty("auth")&&firebase.auth().getRedirectResult().then((function(e){if(e.credential){var t=e.user;e.credential.accessToken;ke("vibebp").setData("firebaseUser",t),t.getIdToken().then((function(t){K(e,t).then((function(e){ke("vibebp").setUser(e)}))}))}e.user})).catch((function(e){console.log(e)}))}),[]);var V=function(e){e.detail.hasOwnProperty("url")&&e.detail.url&&(console.log(e.detail.url),localforage.removeItem(e.detail.url).then((function(){document.dispatchEvent(new Event("vibebp_component_reload"))})))},K=function(e,t){return fetch("".concat(window.vibebp.api.url,"/sociallogin?client_id=").concat(window.vibebp.settings.client_id,"&nocache"),{method:"post",body:JSON.stringify({social:e.credential.signInMethod,client_id:window.vibebp.settings.client_id,user:{email:e.user.email,uid:e.user.uid,name:e.user.displayName,avatar:e.user.photoURL,phoneNumber:e.user.phoneNumber,last_login:e.user.metadata.lastSignInTime,create_time:e.user.metadata.creationTime},idToken:t})}).then((function(e){return e.json()})).then((function(t){if(t.status)return localforage.setItem("bp_login_token",t.token),fetch("".concat(window.vibebp.api.validate_token,"?client_id=").concat(window.vibebp.settings.client_id,"&forces"),{method:"post",body:t.token}).then((function(e){return e.json()})).then((function(n){if(n.hasOwnProperty("data"))return"undefined"!=typeof firebase&&firebase&&firebase.hasOwnProperty("database")&&window.vibebp.settings.firebase_config&&firebase.database().ref("users/".concat(n.data.data.user.id,"/firebaseUid")).set(e.user.uid),a(e.user.uid).then((function(e){if(!e||!e.length){if(localforage.setItem("bp_user",JSON.stringify(n.data.data.user)),sessionStorage.setItem("bp_user",JSON.stringify(n.data.data.user)),s(n.data.data.user),ke("vibebp").setToken(t.token),ke("vibebp").setUser(n.data.data.user),document.querySelector("body").classList.add("vibebp-logged-in"),window.vibebp.settings.login_redirect&&n.hasOwnProperty("redirect_component")&&n.redirect_component){var i="";i=n.redirect_component.split("http").length>1?n.redirect_component:n.redirect_component.split("#").length>1?window.vibebp.settings.login_redirect+n.data.data.user.slug+n.redirect_component:window.vibebp.settings.login_redirect+n.data.data.user.slug+"#"+n.redirect_component,window.location.href=i}var r=sessionStorage.getItem("loggedinmenu");return r?ke("vibebp").setData("loggedinMenu",JSON.parse(r)):fetch("".concat(window.vibebp.api.url,"/loggedinmenu"),{method:"post",body:JSON.stringify({token:t.token})}).then((function(e){return e.json()})).then((function(e){e.status&&(sessionStorage.setItem("loggedinmenu",JSON.stringify(e.menu)),ke("vibebp").setData("loggedinMenu",e.menu))})),n.data.data.user}document.dispatchEvent(new Event("vibebp_logout"))}))}))}))},Z=function(e){if(e.hasOwnProperty("read")&&e.read)return!1;var t=pe(Ie("vibebp").getNotifications()),n=t.findIndex((function(t){return t.id===e.id}));n>=0&&(t[n].read=!0,e.read=!0,Ie("vibebp").updateNotification(e))};return wp.element.createElement(Oe,null,"static"!=e.type?o&&Object.keys(o).length?wp.element.createElement("div",{className:"loggedin_user_div"},wp.element.createElement("a",{className:"loggedin_user","data-id":o.id,onClick:function(){w(!m)}},wp.element.createElement("img",{src:o.avatar,alt:o.displayname}),wp.element.createElement("span",{className:"vibebp_name"},o.displayname)),m?wp.element.createElement(oe,{logout:function(){if("undefined"!=typeof firebase&&firebase&&firebase.hasOwnProperty("database")&&window.vibebp.settings.firebase_config&&window.vibebp.settings.session_lock&&firebase.auth().currentUser){var e=new CustomEvent("userLogout",{detail:{userLoaded:!0,loggedOut:!0}});document.dispatchEvent(e),firebase.database().ref("users/".concat(o.id,"/status")).set(0).then((function(){document.querySelector("body").classList.add("vibebp_logout"),firebase.auth().signOut().then((function(){s({}),Ie("vibebp").logout()}),(function(e){console.log("logout failed")}))}))}else{e=new CustomEvent("userLogout",{detail:{userLoaded:!0,loggedOut:!0}});document.dispatchEvent(e),document.querySelector("body").classList.add("vibebp_logout"),window.vibebp.settings.firebase_config?firebase.auth().signOut().then((function(){s({}),Ie("vibebp").logout()}),(function(e){console.log("logout failed")})):(s({}),Ie("vibebp").logout())}}}):"",wp.element.createElement(Oe,null,window.vibebp.settings.firebase_config&&"on"!=window.vibebp.settings.hide_live&&firebase.auth()&&firebase.auth().currentUser?wp.element.createElement("span",{className:"login_extras",onClick:function(){C(!U);var e=new CustomEvent("loginExtras",{detail:{loginExtras:!0}});document.dispatchEvent(e)}},wp.element.createElement("span",{className:U?"vicon vicon-align-right":"vicon vicon-align-left"})):"")):wp.element.createElement("a",{onClick:function(e){e.stopPropagation(),i(!0),setTimeout((function(){A(P+" active")}),30)}},q?"...":wp.element.createElement("span",{dangerouslySetInnerHTML:{__html:e.title}})):"",n||"static"==e.type&&o&&!Object.keys(o).length?ReactDOM.createPortal(wp.element.createElement("div",{className:e.hasOwnProperty("type")&&"static"==e.type?"static_wrapper":"loginpopup_wrapper",onClick:function(e){e.stopPropagation(),-1!==e.target.className.indexOf("loginpopup_wrapper")&&(A(P.replace(/active/g)),i(!1))}},wp.element.createElement("div",{className:P},window.vibebp.settings.customizer.login_image.length?wp.element.createElement("div",{className:"login_popup_bg_img"},wp.element.createElement("img",{src:window.vibebp.settings.customizer.login_image})):"",e.hasOwnProperty("type")&&"static"==e.type&&l?wp.element.createElement("div",{className:"login_popup_content"},wp.element.createElement("h2",{dangerouslySetInnerHTML:{__html:window.vibebp.translations.login_heading}}),p?wp.element.createElement("h2",{dangerouslySetInnerHTML:{__html:p.displayname}}):wp.element.createElement("h2",null,"...")):wp.element.createElement("div",{className:window.vibebp.settings.email_login?"login_popup_content email_login":"login_popup_content"},window.vibebp.settings.email_login?k?wp.element.createElement(Y,{setRegistration:I}):wp.element.createElement(Oe,null,wp.element.createElement(J,{setemailSignIn:S,setUser:function(e){s(e),i(!1)}}),O?wp.element.createElement(g,{setLoginpopupClass:A,setUser:function(e){s(e),i(!1)},setRegistration:I,setemailSignIn:S}):""):O?wp.element.createElement(J,{setemailSignIn:S,setUser:function(e){s(e),i(!1)}}):k?wp.element.createElement(Y,{setRegistration:I}):wp.element.createElement(g,{setLoginpopupClass:A,setUser:function(e){s(e),i(!1)},setRegistration:I,setemailSignIn:S}),"static"!=e.type?wp.element.createElement("a",{onClick:function(e){e.stopPropagation(),A(P.replace(/active/g)),i(!1)},className:"vicon-close"}):""))),document.querySelector("#vibebp_login_wrapper")):"","")};document.addEventListener("DOMContentLoaded",(function(){document.querySelector(".vibebp-login")&&document.querySelectorAll(".vibebp-login").forEach((function(e){Se(wp.element.createElement(Pe,{type:document.querySelector(".vibebp-login").getAttribute("type"),title:e.innerHTML}),e)})),document.addEventListener("wp_login_sync",(function(){document.querySelector(".vibebp-login")&&document.querySelectorAll(".vibebp-login").forEach((function(e){Se(wp.element.createElement(Pe,{type:document.querySelector(".vibebp-login").getAttribute("type"),title:e.innerHTML}),e)}))}))}),!1),document.addEventListener("vibebp_logout",(function(){window.vibebp.settings.firebase_config&&firebase&&firebase.auth()?firebase.auth().signOut().then((function(){Ie("vibebp").logout()}),(function(e){console.log("logout failed")})):Ie("vibebp").logout()})),document.querySelector(".vibebp-login")&&document.querySelectorAll(".vibebp-login").forEach((function(e){Se(wp.element.createElement(Pe,{type:document.querySelector(".vibebp-login").getAttribute("type"),title:e.innerHTML}),e)}))}]);