!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n.r(t);var i=wp.element,o=(i.createElement,i.useState),a=(i.useEffect,i.Fragment),s=(i.render,wp.data),l=(s.dispatch,s.select),c=function(e){var t=r(o(!1),2),n=t[0],i=(t[1],r(o(!1),2)),s=i[0],c=i[1],u=r(o(""),2),f=u[0],d=u[1],p=r(o(!1),2),m=p[0],b=p[1];return wp.element.createElement(a,null,s?wp.element.createElement("div",{className:"messagebox"},wp.element.createElement("textarea",{value:f,placeholder:window.vibebpactions.translations.message_text,onChange:function(e){return d(e.target.value)}}),wp.element.createElement("div",null,wp.element.createElement("a",{className:m?"button is-primary is-loading":"button is-primary",onClick:function(){b(!0);var t=new FormData;t.append("body",JSON.stringify({args:{content:f,recipients:[e.user_id],subject:window.vibebpactions.translations.message_subject,thread_id:0,meta:[]},token:e.token})),fetch("".concat(window.vibebpactions.api_url,"/messages/send?post"),{method:"post",body:t}).then((function(e){return e.json()})).then((function(e){b(!1),c(!1)}))},dangerouslySetInnerHTML:{__html:e.alt}}),wp.element.createElement("a",{className:"link",onClick:function(){return c(!1)}},window.vibebpactions.translations.cancel))):l("vibebp").getUser().id!=e.user_id?wp.element.createElement("span",{className:n?"button is-primary is-loading":"button is-primary",dangerouslySetInnerHTML:{__html:e.def},onClick:function(){return c(!0)}}):"")};function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var f=wp.element,d=(f.createElement,f.useState),p=f.useEffect,m=f.Fragment,b=(f.render,wp.data),y=b.dispatch,v=b.select,w=function(e){var t=u(d(!1),2),n=t[0],r=t[1],i=u(d(!1),2),o=i[0],a=i[1];p((function(){var t=v("vibebp").getData("friends");void 0!==t&&Array.isArray(t)?Array.isArray(t)&&t.indexOf(parseInt(e.user_id))>-1&&a(!0):(console.log("fetch it"),fetch("".concat(window.vibebpactions.api_url,"/friend_ids?force"),{method:"post",body:JSON.stringify({token:e.token})}).then((function(e){return e.json()})).then((function(n){n.status&&(t=n.friends,y("vibebp").setData("friends",n.friends),t.indexOf(e.user_id)>-1&&a(!0))})))}),[]);return wp.element.createElement(m,null,o?wp.element.createElement("span",{className:n?"button is-primary is-loading":"button is-primary",onClick:function(){r(!0),fetch("".concat(window.vibebpactions.api_url,"/friends/removefriendship?post"),{method:"post",body:JSON.stringify({friend_userid:e.user_id,token:e.token})}).then((function(e){return e.json()})).then((function(e){r(!1),a(!1)})),setFriends(nfriends)},dangerouslySetInnerHTML:{__html:e.alt}}):v("vibebp").getUser().id!=e.user_id?wp.element.createElement("span",{className:n?"button is-primary is-loading":"button is-primary",onClick:function(){r(!0),fetch("".concat(window.vibebp.api.url,"/friends/addfriendship?post"),{method:"post",body:JSON.stringify({friends:[e.user_id],token:e.token})}).then((function(e){return e.json()})).then((function(e){r(!1),a(!0)}))},dangerouslySetInnerHTML:{__html:e.def}}):"")};function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var h=wp.element,_=(h.createElement,h.useState),E=h.useEffect,S=h.Fragment,O=(h.render,wp.data),A=O.dispatch,j=O.select,k=function(e){var t=g(_(!1),2),n=t[0],r=t[1],i=g(_(!1),2),o=i[0],a=i[1];E((function(){var t=j("vibebp").getData("following");Array.isArray(t)&&t.indexOf(e.user_id)>-1&&a(!0)}),[]);var s=function(t){r(!0),fetch("".concat(window.vibebpactions.api_url,"/followers/action?post"),{method:"post",body:JSON.stringify({action:t,user:e.user_id,token:e.token})}).then((function(e){return e.json()})).then((function(n){if(r(!1),n.status){if("follow"===t){var i=j("vibebp").getData("following");i.push(e.user_id),A("vibebp").setData("following",i),a(!0),A("vibebp").addNotification({message:n.message}),A("vibebp").sendRealTimeNotification(n.rtm.user_id,n.rtm.message)}if("unfollow"===t){var o=j("vibebp").getData("following");o.splice(o.indexOf(e.user_id),1),A("vibebp").setData("following",o),a(!1),A("vibebp").addNotification({message:n.message}),A("vibebp").sendRealTimeNotification(n.rtm.user_id,n.rtm.message)}}}))};return wp.element.createElement(S,null,o?wp.element.createElement("span",{className:n?"button is-primary is-loading":"button is-primary",dangerouslySetInnerHTML:{__html:e.alt},onClick:function(){return s("unfollow")}}):j("vibebp").getUser().id!=e.user_id?wp.element.createElement("span",{className:n?"button is-primary is-loading":"button is-primary",dangerouslySetInnerHTML:{__html:e.def},onClick:function(){return s("follow")}}):"")};function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var T=wp.element,L=(T.createElement,T.useState),x=T.useEffect,M=T.Fragment,I=(T.render,wp.data),D=(I.dispatch,I.select),H=function(e){var t=N(L(!1),2),n=t[0],r=t[1];x((function(){var t=D("vibebp").getOnlineMembers();Array.isArray(t)&&t.indexOf(e.user_id)>-1&&r(!0),document.addEventListener("onlinemembers_loaded",(function(t){t.detail&&setTimeout((function(){var t=D("vibebp").getOnlineMembers();Array.isArray(t)&&t.indexOf(e.user_id)>-1&&r(!0)}),200)}))}),[]);return wp.element.createElement(M,null,D("vibebp").getUser().id!=e.user_id?n?wp.element.createElement("span",{onClick:function(){document.dispatchEvent(new CustomEvent("trigger_user_chat",{detail:{userId:e.user_id}}))},className:"button is-primary",dangerouslySetInnerHTML:{__html:e.def}}):wp.element.createElement("span",{className:"button is-primary",dangerouslySetInnerHTML:{__html:e.alt+" ("+window.vibebpactions.translations.offline+")"}}):"")},C=wp.element,F=(C.createElement,C.useState,C.useEffect),q=(C.Fragment,C.render,wp.data),J=(q.dispatch,q.select,function(e){return F((function(){})),wp.element.createElement("span",{className:"button is-primary",dangerouslySetInnerHTML:{__html:e.def}})}),P=wp.element,U=(P.createElement,P.useState,P.useEffect,P.Fragment,P.render),R=wp.data,z=R.dispatch,B=R.select;document.addEventListener("vibebp_all_members_loaded",(function(){localforage.getItem("bp_login_token").then((function(e){e?(document.querySelectorAll(".member_action").forEach((function(e){e.getAttribute("data-member"),e.querySelector("span").innerHTML;e.style.display="none"})),G(e)):document.querySelectorAll(".member_action").forEach((function(e){e.addEventListener("click",(function(){document.dispatchEvent(new Event("vibebp_show_login_popup"))}))}))}))}));var G=function(e){K(e).then((function(){Q(e).then((function(){document.querySelectorAll(".member_action").forEach((function(t){var n=t.getAttribute("data-member"),r=t.querySelector("span").innerHTML,i="";t.querySelector("span.hide")&&(i=t.querySelector("span.hide").innerHTML),t.style.display="initial",t.classList.contains("send_message")&&U(wp.element.createElement(c,{user_id:n,token:e,def:r,alt:i}),t),t.classList.contains("friend")&&U(wp.element.createElement(w,{user_id:n,token:e,def:r,alt:i}),t),t.classList.contains("follow")&&U(wp.element.createElement(k,{user_id:n,token:e,def:r,alt:i}),t),t.classList.contains("chat")&&U(wp.element.createElement(H,{user_id:n,token:e,def:r,alt:i}),t),t.classList.contains("view_profile")&&U(wp.element.createElement(J,{user_id:n,def:r}),t)}))}))}))},K=function(e){return!window.vibebpactions.friends||B("vibebp")&&B("vibebp").getData("friends")?new Promise((function(e){e()})):fetch("".concat(window.vibebpactions.api_url,"/friend_ids?force"),{method:"post",body:JSON.stringify({token:e})}).then((function(e){return e.json()})).then((function(e){e.status&&(e.friends&&Array.isArray(e.friends)?z("vibebp").setData("friends",e.friends):z("vibebp").setData("friends",[]))}))},Q=function(e){return!window.vibebpactions.followers||B("vibebp")&&B("vibebp").getData("following")?new Promise((function(e){e()})):fetch("".concat(window.vibebpactions.api_url,"/following_ids?force"),{method:"post",body:JSON.stringify({token:e})}).then((function(e){return e.json()})).then((function(e){e.status&&z("vibebp").setData("following",e.following)}))}}]);